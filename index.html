<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAMERYT Quiz Game - Education</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family:  sans-serif;
            background-color: #f0f0f0;
        }

        body.dark-mode {
            background-color: #200046;
            color: #e0e0e0;
        }

        body.dark-mode .modal {
           background-color: #4b0ae2;
        }
       

        body.dark-mode .start-screen {
            background: linear-gradient(135deg, #32006b 60%, #7817d3 100%);
            box-shadow: 0 8px 32px rgba(44, 0, 94, 0.18);
        }

        body.dark-mode .top-bar {
            background-color: #32006b;
        }

        button {
            padding: 15px 30px;
            background-color: #7817d3;
            border-radius: 40px;
            border: none;
            color: white;
        }
        button:hover {
            cursor: pointer;
            background-color: #5a14a0;
        }
        .start-screen {
            display: flex !important;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #4b0ae2 60%, #7817d3 100%);
            box-shadow: 0 8px 32px rgba(44, 0, 94, 0.18);
            border-radius: 18px;
            padding: 32px 24px;
            width: 95%;
            max-width: 620px;
            margin: 48px auto;
            min-height: 520px;
            color: #fff;
            text-align: center;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
        }
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background-color: #4b0ae2;
            color: white;
        }
        .top-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .nav-bar {
            display: flex;
            gap: 16px;
        }
        .nav-link {
            background: none;
            border: none;
            color: white;
            font-size: 1rem;
            cursor: pointer;
        }

        .content {
            padding: 18px 35px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            max-height: 80% !important;
            max-width: 640px;
            margin: auto;
            padding: 12px 22px;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.18);
            max-height: 150px;
            background: rgba(0, 0, 0, 0.4);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #quiz-temp, #quiz-created, #quiz-completed {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 12px;
            background-color: #3d0088;
            border-radius: 12px;
            padding: 16px;
        } 

        .profile-btn {
            display: flex;
            align-items: center;
            color: white;
            gap: 8px;
            font-size: 1rem;
            cursor: pointer;
        }

        textarea {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            resize: vertical;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background-color: #6237ff;
            border-radius: 8px;
            padding: 8px 12px;
            margin-bottom: 16px;
        }
        .search-bar input {
            border: none !important;
            outline: none !important;
            background: transparent;
            color: white;
        }

        .profile-menu .item {
            padding: 10px 20px;
            color: white;
            cursor: pointer;
        }
        .menu-btn {
            display: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        .content h1 {
            font-size: 2.7rem;
        }

        .quiz-screen {
            display: none;
            padding: 20px;
            background-color: #6237ff;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            max-width: 800px;
        }
        .profile-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background-color: #4b0ae2;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            gap: 8px;
        }
        .next, .third, .fourth, .fifth {
            display: none;
        }

        input[type="text"],
        input[type="password"],
        select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ccc;
        }


        @media (max-width: 768px) {
            .content h1 {
                font-size: 1.6rem;
            }
        }


        @media (max-width: 576px) {
            .content {
                padding: 5px;
            }
        }


        @media (max-width: 768px) {
            .quiz-stats {
                flex-wrap: wrap;
                width: 100%;
            }
        }


        @media (max-width: 1300px) {
            #profileName {
                display: none;
            }
        }

        @media (max-width: 860px) {
            .top-bar {
            flex-direction: column;
            align-items: flex-start;
            position: relative;
            }

            .profile-btn {
                padding: 10px 15px !important;
            }
            .nav-bar {
            width: 100%;
            justify-content: flex-start;
            margin-top: 12px;
            }
            .top-right {
            position: absolute;
            top: 9px;
            right: 16px;
            flex-direction: row;
            width: auto;
            }
        }
        
        @media (max-width: 500px) {
            .logo {
                display: none;
            }
            .nav-bar {
                display: none;
            }
            .menu-btn {
                display: block;
            }
        }
        @media (max-width: 600px) {
            .nav-bar {
                gap: 2px;
            }
        }
    </style>
</head>
<body>
    <div class="start-screen">
        <div class="close">
            <span class="material-symbols-outlined" onclick="
            document.querySelector('.start-screen').style.display='none';
            document.querySelector('.start-screen').style.setProperty('display','none','important');
            sessionStorage.setItem('startScreenClosed', '1');
            ">close</span>
        </div>
        <div class="first">
        <h2>Welcome to GAMERYT Math Quiz</h2>
        <p>Let a teacher if you're at school enter your name</p>
        <input type="text" id="nameInput" placeholder="Enter your name (max 30 characters, teacher only)" maxlength="30">
        <button id="nextButton">Next</button>
    </div>
    <div class="next">
        <h2>Choose a Grade (Teacher can only do this)</h2>
        <select id="gradeSelect">
            <option value="" disabled selected>Select your grade</option>
        
            <option value="1">Grade 1</option>
            <option value="2">Grade 2</option>
            <option value="3">Grade 3</option>
            <option value="4">Grade 4</option>
            <option value="5">Grade 5</option>
            <option value="6">Grade 6</option>
            <option value="7">Grade 7</option>
        </select>
        <button id="startQuizButton">Next</button>
    </div>
    <div class="third">
        <h2>Choose a Language (Teacher can only do this)</h2>
        <select id="languageSelect">
            <option value="en">English</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
            <option value="de">German</option>
        </select>
        <button id="languageButton">Next</button>
    </div>
    <div class="fourth">
        <h2>Choose a Theme (You can only do this)</h2>
        <select id="themeSelect">
            <option value="light">Light</option>
            <option value="dark">Dark</option>
        </select>
        <button id="themeButton">Next</button>
    </div>
    <div class="fifth">
        <h2>Enter a password to access settings (Teacher can only do this)</h2>
        <input type="password" id="passwordInput" placeholder="Enter password">
        <button id="submitPasswordButton">Go</button>
    </div>
    </div>
    <div class="home-screen">
        <div class="top-bar">
            <div class="menu-btn">
                <span class="material-symbols-outlined">menu</span>
            </div>
            <div class="logo">
            <span class="material-symbols-outlined">calculate</span>
            <span class="logo-text">Math Quiz</span>
        </div>
        <div class="nav-bar">
            <button class="nav-link" data-page="homeContent">Home</button>
            <button class="nav-link" data-page="historyContent">History</button>
            <button class="nav-link" data-page="createContent">Create</button>
            <button class="nav-link" data-page="myActivityContent">My Activity</button>
        </div>
        <div class="top-right">
            <button class="profile-btn">
                <span class="material-symbols-outlined">account_circle</span>
                <span id="profileName"></span>
                <!-- Arrow down icon-->
                <span class="material-symbols-outlined">arrow_drop_down</span>
            </button>
            <div class="profile-menu">
                <div class="item" id="adminSettings">
                    Admin Settings (teachers only)
                </div>
            </div>
            <div class="dark-mode" id="dark-mode-toggle">
                <span class="material-symbols-outlined">dark_mode</span>
            </div>
            <div class="ai-assist" id="ai-assist">
                <span class="material-symbols-outlined">smart_toy</span>
            </div>
        </div>
        </div>
        <div class="content" id="homeContent">
            <h1>Home</h1>
            <h3>Template Quizzes</h3>
            <div id="quiz-temp"></div>
         <h3>Quizzes that I Created</h3>
        <div id="quiz-created-home"></div>
         <h3>Completed Quizzes</h3>
         <div id="quiz-completed"></div>
        </div>
        <div class="content" id="historyContent" style="display: none;">
            <h1>History</h1>
            <div class="search-bar">
                <span class="material-symbols-outlined">search</span>
                <input type="text" name="searchHistory" id="searchHistory" placeholder="Search history..." />
            </div>
            <div id="historyList"></div>
        </div>
        <div class="content" id="createContent" style="display: none;">
            <h1>Create</h1>
            <button style="float: right; margin-top: -70px; display: flex; align-items: center; gap: 5px;" class="create-quiz-btn">
            <span class="material-symbols-outlined">add</span>
                Create Quiz
            </button>
            <div id="quiz-created"></div>
        </div>
        <div class="content" id="myActivityContent" style="display: none;">
            <h1>My Activity</h1>
            <!-- Profile Section -->
            <div id="profile-section" style="display:flex;flex-direction:column;align-items:center;gap:18px;margin-bottom:32px;">
                <div style="font-size:2rem;font-weight:700;color:#7817d3;" id="activityProfileName"></div>
                <!-- Stats Grid -->
                <div id="profile-stats-grid" style="display:flex;flex-wrap:wrap;gap:18px;justify-content:center;width:100%;max-width:520px;">
                    <div class="stat-box" style="flex:1 1 120px;min-width:120px;background:#f7f3ff;color:#7817d3;border-radius:12px;padding:18px;text-align:center;box-shadow:0 2px 8px rgba(120,23,211,0.07);">
                        <div style="font-size:1.2rem;font-weight:600;" id="stat-completed">0</div>
                        <div style="font-size:0.98rem;">Completed</div>
                    </div>
                    <div class="stat-box" style="flex:1 1 120px;min-width:120px;background:#f7f3ff;color:#7817d3;border-radius:12px;padding:18px;text-align:center;box-shadow:0 2px 8px rgba(120,23,211,0.07);">
                        <div style="font-size:1.2rem;font-weight:600;" id="stat-total-points">0</div>
                        <div style="font-size:0.98rem;">Total Points</div>
                    </div>
                    <div class="stat-box" style="flex:1 1 120px;min-width:120px;background:#f7f3ff;color:#7817d3;border-radius:12px;padding:18px;text-align:center;box-shadow:0 2px 8px rgba(120,23,211,0.07);">
                        <div style="font-size:1.2rem;font-weight:600;" id="stat-created-quizzes">0</div>
                        <div style="font-size:0.98rem;">Created Quizzes</div>
                    </div>
                    <div class="stat-box" style="flex:1 1 120px;min-width:120px;background:#f7f3ff;color:#7817d3;border-radius:12px;padding:18px;text-align:center;box-shadow:0 2px 8px rgba(120,23,211,0.07);">
                        <div style="font-size:1.2rem;font-weight:600;" id="stat-created-on">-</div>
                        <div style="font-size:0.98rem;">Created On</div>
                    </div>
                </div>
            </div>

            <!-- Achievements Section -->
            <div id="achievements-section" style="max-width:620px;margin:0 auto;">
                <h3 style="color:#7817d3;">Achievements <span id="achievements-count" style="font-size:1rem;color:#555;"></span></h3>
                <div id="achievements-list" style="display:flex;flex-direction:column;gap:14px;margin-bottom:32px;"></div>

                <h3 style="color:#7817d3;">In Progress Achievements</h3>
                <div id="inprogress-list" style="display:flex;flex-direction:column;gap:14px;margin-bottom:32px;"></div>

                <h3 style="color:#7817d3;">All Achievements</h3>
                <div id="all-achievements-list" style="display:flex;flex-direction:column;gap:14px;"></div>
            </div>

            <script>
            (function() {
                // Example achievements definition
                const allAchievements = [
                    {
                        id: "300points",
                        name: "300 POINTS!!!",
                        desc: "Reach 300 Points on 1 Quiz",
                        check: profile => (profile.maxQuizScore || 0) >= 300,
                        progress: profile => Math.min(100, Math.round(100 * (profile.maxQuizScore || 0) / 300)),
                        progressText: profile => `${profile.maxQuizScore || 0} / 300`
                    },
                    {
                        id: "megaquizzes",
                        name: "Quizzes of MEGA!",
                        desc: "Complete All the Template quiz with 0 Wrong answers",
                        check: profile => (profile.megaQuizCount || 0) >= (profile.totalTemplateQuizzes || 1),
                        progress: profile => Math.round(100 * (profile.megaQuizCount || 0) / (profile.totalTemplateQuizzes || 1)),
                        progressText: profile => `${profile.megaQuizCount || 0} / ${profile.totalTemplateQuizzes || 1}`
                    },
                    {
                        id: "500total",
                        name: "500 Points",
                        desc: "Reach Total points on quizzes",
                        check: profile => (profile.totalPoints || 0) >= 500,
                        progress: profile => Math.min(100, Math.round(100 * (profile.totalPoints || 0) / 500)),
                        progressText: profile => `${profile.totalPoints || 0} / 500`
                    },
                    {
                        id: "firstquiz",
                        name: "First Quiz!",
                        desc: "Complete your first quiz",
                        check: profile => (profile.completedCount || 0) >= 1,
                        progress: profile => Math.min(100, Math.round(100 * (profile.completedCount || 0))),
                        progressText: profile => `${profile.completedCount || 0} / 1`
                    },
                    {
                        id: "createquiz",
                        name: "Quiz Creator",
                        desc: "Create your first quiz",
                        check: profile => (profile.createdQuizzes || 0) >= 1,
                        progress: profile => Math.min(100, Math.round(100 * (profile.createdQuizzes || 0))),
                        progressText: profile => `${profile.createdQuizzes || 0} / 1`
                    },
                    // --- Additional Achievements ---
                    {
                        id: "10quizzes",
                        name: "Quiz Veteran",
                        desc: "Complete 10 quizzes",
                        check: profile => (profile.completedCount || 0) >= 10,
                        progress: profile => Math.min(100, Math.round(100 * (profile.completedCount || 0) / 10)),
                        progressText: profile => `${profile.completedCount || 0} / 10`
                    },
                    {
                        id: "1000points",
                        name: "1000 Points Club",
                        desc: "Reach 1000 total points on quizzes",
                        check: profile => (profile.totalPoints || 0) >= 1000,
                        progress: profile => Math.min(100, Math.round(100 * (profile.totalPoints || 0) / 1000)),
                        progressText: profile => `${profile.totalPoints || 0} / 1000`
                    },
                    {
                        id: "5created",
                        name: "Quiz Architect",
                        desc: "Create 5 quizzes",
                        check: profile => (profile.createdQuizzes || 0) >= 5,
                        progress: profile => Math.min(100, Math.round(100 * (profile.createdQuizzes || 0) / 5)),
                        progressText: profile => `${profile.createdQuizzes || 0} / 5`
                    },
                    {
                        id: "perfectscore",
                        name: "Perfectionist",
                        desc: "Score 100 points on a quiz",
                        check: profile => (profile.maxQuizScore || 0) >= 100,
                        progress: profile => Math.min(100, Math.round(100 * (profile.maxQuizScore || 0) / 100)),
                        progressText: profile => `${profile.maxQuizScore || 0} / 100`
                    },
                    {
                        id: "firstcreated",
                        name: "First Creation",
                        desc: "Create your very first quiz",
                        check: profile => (profile.createdQuizzes || 0) >= 1,
                        progress: profile => Math.min(100, Math.round(100 * (profile.createdQuizzes || 0))),
                        progressText: profile => `${profile.createdQuizzes || 0} / 1`
                    },
                    {
                        id: "firsttemplate",
                        name: "Template Explorer",
                        desc: "Complete a template quiz",
                        check: profile => (profile.completedTemplateQuiz || 0) >= 1,
                        progress: profile => Math.min(100, Math.round(100 * (profile.completedTemplateQuiz || 0) / 1)),
                        progressText: profile => `${profile.completedTemplateQuiz || 0} / 1`
                    },
                    {
                        id: "fastquiz",
                        name: "Speedster",
                        desc: "Finish a quiz in under 2 minutes",
                        check: profile => {
                            let history = [];
                            try {
                                history = JSON.parse(localStorage.getItem("quizHistory") || "[]");
                            } catch {}
                            return history.some(q => {
                                if (!q.time) return false;
                                let [min, sec] = q.time.split(":").map(Number);
                                return (min * 60 + sec) <= 120;
                            });
                        },
                        progress: profile => {
                            let history = [];
                            try {
                                history = JSON.parse(localStorage.getItem("quizHistory") || "[]");
                            } catch {}
                            let found = history.some(q => {
                                if (!q.time) return false;
                                let [min, sec] = q.time.split(":").map(Number);
                                return (min * 60 + sec) <= 120;
                            });
                            return found ? 100 : 0;
                        },
                        progressText: profile => {
                            let history = [];
                            try {
                                history = JSON.parse(localStorage.getItem("quizHistory") || "[]");
                            } catch {}
                            let found = history.some(q => {
                                if (!q.time) return false;
                                let [min, sec] = q.time.split(":").map(Number);
                                return (min * 60 + sec) <= 120;
                            });
                            return found ? "Completed" : "Not yet";
                        }
                    },
                    {
                        id: "quizstreak",
                        name: "Streak Starter",
                        desc: "Complete quizzes on 3 different days",
                        check: profile => {
                            let history = [];
                            try {
                                history = JSON.parse(localStorage.getItem("quizHistory") || "[]");
                            } catch {}
                            let days = new Set();
                            history.forEach(q => {
                                if (q.date) {
                                    let d = q.date.split(",")[0].trim();
                                    days.add(d);
                                }
                            });
                            return days.size >= 3;
                        },
                        progress: profile => {
                            let history = [];
                            try {
                                history = JSON.parse(localStorage.getItem("quizHistory") || "[]");
                            } catch {}
                            let days = new Set();
                            history.forEach(q => {
                                if (q.date) {
                                    let d = q.date.split(",")[0].trim();
                                    days.add(d);
                                }
                            });
                            return Math.min(100, Math.round(100 * days.size / 3));
                        },
                        progressText: profile => {
                            let history = [];
                            try {
                                history = JSON.parse(localStorage.getItem("quizHistory") || "[]");
                            } catch {}
                            let days = new Set();
                            history.forEach(q => {
                                if (q.date) {
                                    let d = q.date.split(",")[0].trim();
                                    days.add(d);
                                }
                            });
                            return `${days.size} / 3 days`;
                        }
                    },
                    {
                        id: "activityopen",
                        name: "Explorer",
                        desc: "Open the My Activity page",
                        check: profile => {
                            return !!localStorage.getItem("openedMyActivity");
                        },
                        progress: profile => localStorage.getItem("openedMyActivity") ? 100 : 0,
                        progressText: profile => localStorage.getItem("openedMyActivity") ? "Completed" : "Not yet"
                    }
                ];

                // Helper to get profile stats
                function getProfileStats() {
                    let profile = {};
                    try {
                        profile = JSON.parse(localStorage.getItem("schoolProfile") || "{}");
                    } catch {}
                    // Completed quizzes
                    let completed = [];
                    try {
                        completed = JSON.parse(localStorage.getItem("quizCompleted") || "[]");
                    } catch {}
                    profile.completedCount = completed.length;
                    profile.maxQuizScore = completed.reduce((max, q) => Math.max(max, q.score || 0), 0);
                    profile.totalPoints = completed.reduce((sum, q) => sum + (q.score || 0), 0);
                    // Created quizzes
                    let created = [];
                    try {
                        created = JSON.parse(localStorage.getItem("quizCreated") || "[]");
                    } catch {}
                    profile.createdQuizzes = created.length;
                    // Created On
                    profile.createdOn = profile.createdOn || profile.created || profile.createdAt || "";
                    // If not set, try to get from meta or set now
                    if (!profile.createdOn) {
                        let meta = localStorage.getItem("schoolProfileMeta");
                        if (meta) {
                            try {
                                let m = JSON.parse(meta);
                                if (m.createdOn) profile.createdOn = m.createdOn;
                            } catch {}
                        }
                        // If still not set, set now and save
                        if (!profile.createdOn) {
                            profile.createdOn = new Date().toISOString();
                            // Save to profile and meta for future
                            try {
                                let p = JSON.parse(localStorage.getItem("schoolProfile") || "{}");
                                p.createdOn = profile.createdOn;
                                localStorage.setItem("schoolProfile", JSON.stringify(p));
                                localStorage.setItem("schoolProfileMeta", JSON.stringify({ createdOn: profile.createdOn }));
                            } catch {}
                        }
                    }
                    // Mega quiz logic: all template quizzes with 0 wrong (score >= 100)
                    let quizTemp = window.quizTemp || [];
                    if (!quizTemp.length && window.quizTempContainer) {
                        quizTemp = [];
                    }
                    profile.totalTemplateQuizzes = quizTemp.length || 3;
                    profile.megaQuizCount = completed.filter(q => quizTemp.some(t => t.title === q.title) && q.score >= 100).length;
                    profile.megaQuizzes = profile.megaQuizCount === profile.totalTemplateQuizzes;
                    // Completed a template quiz
                    profile.completedTemplateQuiz = completed.filter(q => quizTemp.some(t => t.title === q.title)).length;
                    return profile;
                }

                // Render profile name and stats
                function renderProfileStats() {
                    const profile = getProfileStats();
                    document.getElementById("activityProfileName").textContent = profile.name || "Profile";
                    document.getElementById("stat-completed").textContent = profile.completedCount || 0;
                    document.getElementById("stat-total-points").textContent = profile.totalPoints || 0;
                    document.getElementById("stat-created-quizzes").textContent = profile.createdQuizzes || 0;
                    // Show date created in readable format
                    if (profile.createdOn) {
                        let d = new Date(profile.createdOn);
                        let dateStr = d.toLocaleDateString() + " " + d.toLocaleTimeString();
                        document.getElementById("stat-created-on").textContent = dateStr;
                    } else {
                        document.getElementById("stat-created-on").textContent = "-";
                    }
                }

                // Render achievements
                function renderAchievements() {
                    const profile = getProfileStats();
                    const achieved = [];
                    const inprogress = [];
                    allAchievements.forEach(a => {
                        if (a.check(profile)) {
                            achieved.push(a);
                        } else {
                            inprogress.push(a);
                        }
                    });

                    // Achieved
                    const achList = document.getElementById("achievements-list");
                    achList.innerHTML = achieved.length
                        ? achieved.map(a => `
                            <div style="background:#e0ffe0;border-radius:10px;padding:14px 18px;box-shadow:0 1px 6px rgba(46,204,64,0.08);">
                                <div style="font-weight:600;font-size:1.1rem;color:#2ecc40;">${a.name}</div>
                                <div style="font-size:0.97rem;color:#222;">${a.desc}</div>
                            </div>
                        `).join("")
                        : `<div style="color:#888;">No achievements yet.</div>`;

                    // In Progress
                    const inprogList = document.getElementById("inprogress-list");
                    inprogList.innerHTML = inprogress.length
                        ? inprogress.map(a => {
                            const pct = a.progress(profile);
                            return `
                                <div style="background:#fffbe6;border-radius:10px;padding:14px 18px;box-shadow:0 1px 6px rgba(255,193,7,0.08);">
                                    <div style="font-weight:600;font-size:1.1rem;color:#ff9800;">${a.name}</div>
                                    <div style="font-size:0.97rem;color:#222;">${a.desc}</div>
                                    <div style="margin-top:8px;">
                                        <div style="background:#eae6fa;border-radius:6px;height:14px;width:100%;overflow:hidden;">
                                            <div style="background:#7817d3;height:100%;width:${pct}%;transition:width 0.5s;"></div>
                                        </div>
                                        <div style="font-size:0.95rem;color:#555;margin-top:2px;">${a.progressText(profile)} (${pct}%)</div>
                                    </div>
                                </div>
                            `;
                        }).join("")
                        : `<div style="color:#888;">No in-progress achievements.</div>`;

                    // All achievements
                    const allList = document.getElementById("all-achievements-list");
                    allList.innerHTML = allAchievements.map(a => {
                        const done = a.check(profile);
                        const pct = a.progress(profile);
                        return `
                            <div style="background:${done ? "#e0ffe0" : "#f7f3ff"};border-radius:10px;padding:14px 18px;box-shadow:0 1px 6px rgba(120,23,211,0.06);">
                                <div style="font-weight:600;font-size:1.1rem;color:${done ? "#2ecc40" : "#7817d3"};">${a.name}</div>
                                <div style="font-size:0.97rem;color:#222;">${a.desc}</div>
                                <div style="font-size:0.95rem;color:#555;margin-top:2px;">${done ? "Completed" : `Progress: ${a.progressText(profile)} (${pct}%)`}</div>
                            </div>
                        `;
                    }).join("");

                    // Achievements count
                    document.getElementById("achievements-count").textContent = `(${achieved.length} of ${allAchievements.length})`;
                }

                // On page load and when switching to My Activity
                function updateActivityPage() {
                    // Mark that user opened My Activity (for achievement)
                    localStorage.setItem("openedMyActivity", "1");
                    renderProfileStats();
                    renderAchievements();
                }
                window.addEventListener("DOMContentLoaded", updateActivityPage);
                // Also update when navigating to My Activity tab
                document.querySelectorAll('.nav-link[data-page="myActivityContent"]').forEach(btn => {
                    btn.addEventListener("click", updateActivityPage);
                });
            })();
            </script>
            </div>

    </div>
    <div class="quiz-screen">
        <h2>Quiz</h2>
        <div id="quiz-container">
            <div id="quiz-questions"></div>
        </div>
    </div>






    <!-- Create quiz -->
     <div class="modal" id="createQuizModal" style="display: none;">
        <div class="modal-content">
            <h2>Create quiz</h2>
            <form id="createQuizForm">
                <label for="quizTitle">Title:</label>
                <input type="text" placeholder="Enter a title (Required)" required  id="quizTitleInput">
                <label for="quizDescription">Description:</label>
                <textarea style="resize: vertical;" id="quizDescriptionInput" placeholder="Enter a description (optional)"></textarea>
            </form>
            <button id="createQuizBtn">Create Quiz</button>
            <button id="closeCreateQuizBtn">Close</button>
        </div>
     </div>

    <!-- AI Assistant Modal -->
    <div class="modal" id="aiAssistantModal" style="display:none;z-index:10010;">
        <div class="modal-content ai-modal-content" style="max-width:992px;width:95vw;margin:40px auto;padding:24px 18px 18px 18px;border-radius:14px;box-shadow:0 4px 24px rgba(0,0,0,0.18);position:relative;">
            <span id="closeAIModal" style="position:absolute;top:12px;right:12px;font-size:2rem;cursor:pointer;" class="material-symbols-outlined">close</span>
            <h2 style="margin-top:0;font-size:1.3rem;color:#7817d3;display:flex;align-items:center;gap:8px;">
                <span class="material-symbols-outlined" style="font-size:1.7rem;">smart_toy</span>
                AI Math Assistant
            </h2>
            <div style="margin-bottom:10px;">
                <button id="aiHistoryBtn" style="background:none;border:none;color:#7817d3;cursor:pointer;display:flex;align-items:center;gap:4px;font-size:1rem;">
                    <span class="material-symbols-outlined" style="font-size:1.3rem;">history</span>
                    Recent
                </button>
            </div>
            <div id="aiChatHistory" style="max-height:180px;overflow-y:auto;padding:8px 0 8px 0;margin-bottom:10px;border-bottom:1px solid #eee;"></div>
            <form id="aiAssistantForm" style="display:flex;align-items:center;gap:8px;">
                <input type="text" id="aiMessageInput" placeholder="Ask a math question..." autocomplete="off" style="flex:1;padding:10px;border-radius:6px;border:1px solid #ccc;">
                <button type="submit" id="aiSendBtn" style="background:#7817d3;color:#fff;padding:8px 18px;border:none;border-radius:8px;font-weight:600;cursor:pointer;">Send</button>
            </form>
        </div>
    </div>
    <!-- AI Assistant Recent Modal -->
    <div class="modal" id="aiHistoryModal" style="display:none;z-index:10011;">
        <div class="modal-content ai-modal-content" style="max-width:340px;margin:80px auto;padding:24px 18px 18px 18px;border-radius:12px;box-shadow:0 4px 24px rgba(0,0,0,0.18);position:relative;">
            <span id="closeAIHistoryModal" style="position:absolute;top:12px;right:12px;font-size:2rem;cursor:pointer;" class="material-symbols-outlined">close</span>
            <h3 style="margin-top:0;font-size:1.1rem;color:#7817d3;">Recent AI Assistant Sessions</h3>
            <div id="aiHistoryList" style="max-height:180px;overflow-y:auto;margin-top:10px;"></div>
        </div>
    </div>
    <style>
        /* AI Assistant Modal dark mode */
        body.dark-mode .ai-modal-content {
            background: #32006b !important;
            color: #e0e0e0 !important;
        }
        body.dark-mode #aiAssistantModal .material-symbols-outlined,
        body.dark-mode #aiHistoryModal .material-symbols-outlined {
            color: #fff !important;
        }
        body.dark-mode #aiAssistantModal input,
        body.dark-mode #aiAssistantModal button,
        body.dark-mode #aiHistoryModal button {
            background: #4b0ae2 !important;
            color: #fff !important;
            border-color: #7817d3 !important;
        }
        body.dark-mode #aiAssistantModal input {
            border: 1px solid #7817d3 !important;
        }
        body.dark-mode #aiAssistantModal #aiChatHistory {
            border-bottom: 1px solid #6237ff !important;
        }
    </style>
    <!-- AI Suggestions (inside AI Assistant Modal, under the input) -->
    <script>
        // Helper: get operator symbol for math operation
        function getOperatorSymbol(op) {
            switch (op) {
                case "addition": return "+";
                case "subtraction": return "-";
                case "multiplication": return "ร";
                case "division": return "รท";
                case "fraction": return "/";
                case "percentage": return "%";
                default: return "+";
            }
        }

        // Helper: show modal to add a text option (no prompt)
        function showAddOptionModal(callback) {
            // Create a modal for text input
            let modal = document.createElement("div");
            modal.style.position = "fixed";
            modal.style.top = "0";
            modal.style.left = "0";
            modal.style.width = "100vw";
            modal.style.height = "100vh";
            modal.style.background = "rgba(0,0,0,0.4)";
            modal.style.zIndex = "10020";
            modal.style.display = "flex";
            modal.style.alignItems = "center";
            modal.style.justifyContent = "center";
            modal.innerHTML = `
                <div style="background:#fff;padding:24px 18px;border-radius:12px;box-shadow:0 4px 24px rgba(0,0,0,0.18);min-width:260px;max-width:90vw;">
                    <h3 style="margin-top:0;font-size:1.1rem;color:#7817d3;">Add Option</h3>
                    <input type="text" id="addOptionInput" style="width:100%;padding:8px;margin-bottom:12px;border-radius:5px;border:1px solid #ccc;">
                    <div style="display:flex;gap:10px;justify-content:flex-end;">
                        <button id="addOptionCancel" style="padding:7px 18px;border-radius:6px;border:none;background:#ccc;color:#222;">Cancel</button>
                        <button id="addOptionOk" style="padding:7px 18px;border-radius:6px;border:none;background:#7817d3;color:#fff;">OK</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            const input = modal.querySelector("#addOptionInput");
            input.focus();
            modal.querySelector("#addOptionOk").onclick = function() {
                let val = input.value.trim();
                if (val) callback(val);
                document.body.removeChild(modal);
            };
            modal.querySelector("#addOptionCancel").onclick = function() {
                document.body.removeChild(modal);
            };
            input.addEventListener("keydown", function(e) {
                if (e.key === "Enter") {
                    modal.querySelector("#addOptionOk").click();
                }
            });
            modal.onclick = function(e) {
                if (e.target === modal) document.body.removeChild(modal);
            };
        }

        // Helper: show modal to add an image option (File or URL, no prompt)
        function showAddImageOptionModal(callback) {
            // Modal for image file or URL
            let modal = document.createElement("div");
            modal.style.position = "fixed";
            modal.style.top = "0";
            modal.style.left = "0";
            modal.style.width = "100vw";
            modal.style.height = "100vh";
            modal.style.background = "rgba(0,0,0,0.4)";
            modal.style.zIndex = "10020";
            modal.style.display = "flex";
            modal.style.alignItems = "center";
            modal.style.justifyContent = "center";
            modal.innerHTML = `
                <div style="background:#fff;padding:24px 18px;border-radius:12px;box-shadow:0 4px 24px rgba(0,0,0,0.18);min-width:260px;max-width:90vw;">
                    <h3 style="margin-top:0;font-size:1.1rem;color:#7817d3;">Add Image Option</h3>
                    <div style="margin-bottom:10px;">
                        <input type="file" id="addImageFileInput" accept="image/*" style="margin-bottom:8px;">
                        <div id="addImagePreview" style="margin:6px 0;"></div>
                    </div>
                    <div style="margin-bottom:10px;text-align:center;color:#888;">or</div>
                    <input type="text" id="addImageUrlInput" placeholder="Image URL" style="width:100%;padding:8px;margin-bottom:12px;border-radius:5px;border:1px solid #ccc;">
                    <div style="display:flex;gap:10px;justify-content:flex-end;">
                        <button id="addImageCancel" style="padding:7px 18px;border-radius:6px;border:none;background:#ccc;color:#222;">Cancel</button>
                        <button id="addImageOk" style="padding:7px 18px;border-radius:6px;border:none;background:#7817d3;color:#fff;">OK</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            const fileInput = modal.querySelector("#addImageFileInput");
            const urlInput = modal.querySelector("#addImageUrlInput");
            const preview = modal.querySelector("#addImagePreview");
            fileInput.addEventListener("change", function() {
                if (fileInput.files && fileInput.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.innerHTML = `<img src="${e.target.result}" style="max-width:100px;max-height:60px;border-radius:6px;">`;
                    };
                    reader.readAsDataURL(fileInput.files[0]);
                }
            });
            urlInput.addEventListener("input", function() {
                if (urlInput.value) {
                    preview.innerHTML = `<img src="${urlInput.value}" style="max-width:100px;max-height:60px;border-radius:6px;">`;
                } else {
                    preview.innerHTML = "";
                }
            });
            modal.querySelector("#addImageOk").onclick = function() {
                // Prefer file if present
                if (fileInput.files && fileInput.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        callback(e.target.result);
                        document.body.removeChild(modal);
                    };
                    reader.readAsDataURL(fileInput.files[0]);
                } else if (urlInput.value.trim()) {
                    callback(urlInput.value.trim());
                    document.body.removeChild(modal);
                } else {
                    document.body.removeChild(modal);
                }
            };
            modal.querySelector("#addImageCancel").onclick = function() {
                document.body.removeChild(modal);
            };
            urlInput.addEventListener("keydown", function(e) {
                if (e.key === "Enter") {
                    modal.querySelector("#addImageOk").click();
                }
            });
            modal.onclick = function(e) {
                if (e.target === modal) document.body.removeChild(modal);
            };
        }

        //Create quiz 
        (function() {
            // Elements
            const createQuizBtn = document.querySelector('.create-quiz-btn');
            const createQuizModal = document.getElementById('createQuizModal');
            const closeCreateQuizBtn = document.getElementById('closeCreateQuizBtn');
            const createQuizForm = document.getElementById('createQuizForm');
            const createQuizBtnSubmit = document.getElementById('createQuizBtn');
            // Use the correct containers for both Home and Create pages
            let quizCreatedHomeContainer = document.getElementById('quiz-created-home');
            let quizCreatedCreateContainer = document.getElementById('quiz-created');
            let quizCreated = [];
            try {
                quizCreated = JSON.parse(localStorage.getItem("quizCreated") || "[]");
            } catch {}
            // --- Quiz Editor Modal ---
            let quizEditorModal = document.getElementById('quizEditorModal');
            if (!quizEditorModal) {
                quizEditorModal = document.createElement('div');
                quizEditorModal.id = 'quizEditorModal';
                quizEditorModal.className = 'modal';
                quizEditorModal.style.display = 'none';
                quizEditorModal.innerHTML = `
                    <div class="modal-content" style="max-width:900px;width:98vw;position:relative;padding:24px 18px 18px 18px;border-radius:14px;box-shadow:0 4px 24px rgba(0,0,0,0.18);">
                        <span id="closeQuizEditorModal" style="position:absolute;top:12px;right:12px;font-size:2rem;cursor:pointer;" class="material-symbols-outlined">close</span>
                        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
                            <h2 id="quizEditorTitle" style="margin:0;font-size:1.3rem;color:#7817d3;">Edit Quiz</h2>
                            <button id="saveQuizBtn" style="background:#7817d3;color:#fff;padding:8px 24px;border:none;border-radius:8px;font-weight:600;cursor:pointer;">Save Quiz</button>
                        </div>
                        <div style="margin-top:18px;">
                            <label style="font-weight:600;">Title:</label>
                            <input type="text" id="editQuizTitle" style="width:100%;padding:8px;margin-bottom:8px;border-radius:5px;border:1px solid #ccc;">
                            <label style="font-weight:600;">Description:</label>
                            <textarea id="editQuizDescription" style="width:100%;padding:8px;border-radius:5px;border:1px solid #ccc;resize:vertical;margin-bottom:8px;"></textarea>
                            <label style="font-weight:600;">Quiz Type:</label>
                            <select id="editQuizType" style="width:180px;padding:6px 8px;border-radius:5px;border:1px solid #ccc;margin-bottom:8px;">
                                <option value="math">Math</option>
                                <option value="image">Image Option</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                        <div id="quizQuestionsEditor" style="margin-top:18px;">
                            <h3 style="color:#7817d3;">Questions</h3>
                            <div id="questionsList"></div>
                            <button id="addQuestionBtn" style="margin-top:14px;background:#6237ff;color:#fff;padding:8px 18px;border:none;border-radius:8px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px;">
                                <span class="material-symbols-outlined" style="font-size:1.3rem;">add</span> Add Question
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(quizEditorModal);
            }
            // --- Question Editor Modal ---
            let questionEditorModal = document.getElementById('questionEditorModal');
            if (!questionEditorModal) {
                questionEditorModal = document.createElement('div');
                questionEditorModal.id = 'questionEditorModal';
                questionEditorModal.className = 'modal';
                questionEditorModal.style.display = 'none';
                questionEditorModal.innerHTML = `
                    <div class="modal-content" style="max-width:540px;width:96vw;position:relative;padding:24px 18px 18px 18px;border-radius:14px;box-shadow:0 4px 24px rgba(0,0,0,0.18);">
                        <span id="closeQuestionEditorModal" style="position:absolute;top:12px;right:12px;font-size:2rem;cursor:pointer;" class="material-symbols-outlined">close</span>
                        <h3 id="questionEditorTitle" style="margin-top:0;color:#7817d3;">Add/Edit Question</h3>
                        <form id="questionEditorForm">
                            <div id="questionTypeFields"></div>
                            <div style="margin-top:12px;">
                                <label style="font-weight:600;">Grade:</label>
                                <select id="questionGrade" style="width:100px;padding:6px 8px;border-radius:5px;border:1px solid #ccc;">
                                    <option value="1">Grade 1</option>
                                    <option value="2">Grade 2</option>
                                    <option value="3">Grade 3</option>
                                    <option value="4">Grade 4</option>
                                    <option value="5">Grade 5</option>
                                    <option value="6">Grade 6</option>
                                    <option value="7">Grade 7</option>
                                </select>
                            </div>
                            <div style="margin-top:18px;display:flex;justify-content:flex-end;gap:10px;">
                                <button type="button" id="saveQuestionBtn" style="background:#7817d3;color:#fff;padding:8px 24px;border:none;border-radius:8px;font-weight:600;cursor:pointer;">Save</button>
                            </div>
                        </form>
                    </div>
                `;
                document.body.appendChild(questionEditorModal);
            }
            // --- State ---
            let editingQuizIndex = null;
            let editingQuestionIndex = null;
            let editingQuiz = null;
            // --- Modal Show/Hide ---
            function showModal(modal) { modal.style.display = 'flex'; }
            function hideModal(modal) { modal.style.display = 'none'; }
            // --- Create Quiz Modal ---
            createQuizBtn.addEventListener('click', function() {
                createQuizModal.style.display = 'flex';
                createQuizForm.reset();
            });
            closeCreateQuizBtn.addEventListener('click', function() {
                createQuizModal.style.display = 'none';
            });
            createQuizModal.addEventListener('click', function(e) {
                if (e.target === createQuizModal) createQuizModal.style.display = 'none';
            });
            // --- Add Quiz ---
            createQuizBtnSubmit.addEventListener('click', function() {
                const title = document.getElementById('quizTitleInput').value.trim();
                const description = document.getElementById('quizDescriptionInput').value.trim();
                if (!title) {
                    showToast && showToast("Title required.");
                    return;
                }
                const newQuiz = {
                    title,
                    description,
                    type: "math",
                    questions: []
                };
                quizCreated.push(newQuiz);
                localStorage.setItem("quizCreated", JSON.stringify(quizCreated));
                if (quizCreatedHomeContainer) renderQuizzes(quizCreatedHomeContainer, quizCreated);
                if (quizCreatedCreateContainer) renderQuizzes(quizCreatedCreateContainer, quizCreated);
                createQuizModal.style.display = 'none';
            });
            // --- Render Quizzes with Edit Button ---
            window.renderQuizzes = function renderQuizzes(container, quizzes) {
                container.innerHTML = "";
                if (!quizzes.length) {
                    container.innerHTML = "<p>No quizzes available.</p>";
                    return;
                }
                quizzes.forEach((quiz, idx) => {
                    const quizDiv = document.createElement("div");
                    quizDiv.className = "quiz-item";
                    quizDiv.innerHTML = `
                        <h4>${quiz.title}</h4>
                        <p>${quiz.description || ""}</p>
                        <button class="start-quiz-btn">Start Quiz</button>
                        <button class="edit-quiz-btn" style="margin-left:8px;background:#eae6fa;color:#7817d3;border-radius:8px;padding:7px 16px;border:none;cursor:pointer;">Edit</button>
                    `;
                    // Edit button
                    quizDiv.querySelector('.edit-quiz-btn').onclick = function() {
                        openQuizEditor(idx);
                    };
                    // Start Quiz button
                    quizDiv.querySelector('.start-quiz-btn').onclick = function() {
                        // Deep copy quiz to avoid mutating original
                        const quizCopy = JSON.parse(JSON.stringify(quiz));
                        // Shuffle options for each question and update answer reference
                        if (Array.isArray(quizCopy.questions)) {
                            quizCopy.questions.forEach(q => {
                                if (Array.isArray(q.options) && q.options.length > 1) {
                                    // Always store the correct answer as value, not index
                                    const correctValue = q.answer;
                                    // Shuffle options
                                    q.options = shuffle(q.options);
                                    // After shuffle, set answer to the value (not index)
                                    if (q.options.includes(correctValue)) {
                                        q.answer = correctValue;
                                    } else {
                                        // fallback: pick first option
                                        q.answer = q.options[0];
                                    }
                                }
                            });
                        }
                        startQuiz(quizCopy);
                    };
                    container.appendChild(quizDiv);
                });
            };

            // Initial render
            if (quizCreatedHomeContainer) window.renderQuizzes(quizCreatedHomeContainer, quizCreated);
            if (quizCreatedCreateContainer) window.renderQuizzes(quizCreatedCreateContainer, quizCreated);

            window.addEventListener("DOMContentLoaded", function() {
                let quizCreated = [];
                try {
                    quizCreated = JSON.parse(localStorage.getItem("quizCreated") || "[]");
                } catch {}
                // Render in both containers if they exist
                const homeContainer = document.getElementById('quiz-created-home');
                const createContainer = document.getElementById('quiz-created');
                if (typeof window.renderQuizzes === "function") {
                    if (homeContainer) window.renderQuizzes(homeContainer, quizCreated);
                    if (createContainer) window.renderQuizzes(createContainer, quizCreated);
                }
            });
            // --- Quiz Editor Logic ---
            function openQuizEditor(idx) {
                editingQuizIndex = idx;
                editingQuiz = JSON.parse(JSON.stringify(quizCreated[idx])); // deep copy
                document.getElementById('editQuizTitle').value = editingQuiz.title || "";
                document.getElementById('editQuizDescription').value = editingQuiz.description || "";
                document.getElementById('editQuizType').value = editingQuiz.type || "math";
                renderQuestionsList();
                showModal(quizEditorModal);
            }
            document.getElementById('closeQuizEditorModal').onclick = function() {
                hideModal(quizEditorModal);
            };
            quizEditorModal.addEventListener('click', function(e) {
                if (e.target === quizEditorModal) hideModal(quizEditorModal);
            });
            // --- Save Quiz ---
            document.getElementById('saveQuizBtn').onclick = function() {
                editingQuiz.title = document.getElementById('editQuizTitle').value.trim();
                editingQuiz.description = document.getElementById('editQuizDescription').value.trim();
                editingQuiz.type = document.getElementById('editQuizType').value;
                if (!editingQuiz.title) {
                    showToast && showToast("Title required.");
                    return;
                }
                // Save changes to quizCreated array
                quizCreated[editingQuizIndex] = editingQuiz;
                localStorage.setItem("quizCreated", JSON.stringify(quizCreated));
                if (quizCreatedHomeContainer) renderQuizzes(quizCreatedHomeContainer, quizCreated);
                if (quizCreatedCreateContainer) renderQuizzes(quizCreatedCreateContainer, quizCreated);
                hideModal(quizEditorModal);
                showToast && showToast("Quiz saved.");
            };
            // --- Render Questions List ---
            function renderQuestionsList() {
                const list = document.getElementById('questionsList');
                list.innerHTML = "";
                if (!editingQuiz.questions || !editingQuiz.questions.length) {
                    list.innerHTML = "<div style='color:#888;'>No questions yet.</div>";
                    return;
                }
                editingQuiz.questions.forEach((q, i) => {
                    const div = document.createElement('div');
                    div.style.background = "#f7f3ff";
                    div.style.borderRadius = "8px";
                    div.style.padding = "12px 10px";
                    div.style.marginBottom = "10px";
                    div.style.display = "flex";
                    div.style.alignItems = "center";
                    div.style.justifyContent = "space-between";
                    let imgHtml = "";
                    if ((q.type === "image" || (q.type === "custom" && (q.format === "image" || q.format === "image-text"))) && q.imageUrl) {
                        imgHtml = `<img src="${q.imageUrl}" style="max-width:60px;max-height:40px;border-radius:4px;margin-right:8px;vertical-align:middle;">`;
                    }
                    div.innerHTML = `
                        <div>
                            <b>Q${i+1}:</b> ${imgHtml}${q.question ? q.question : '[No question]'}
                            <span style="color:#7817d3;font-size:0.95rem;margin-left:8px;">(${q.type || editingQuiz.type || "math"})</span>
                        </div>
                        <div>
                            <button class="edit-question-btn" style="background:#7817d3;color:#fff;border:none;border-radius:6px;padding:5px 14px;margin-right:6px;cursor:pointer;">Edit</button>
                            <button class="delete-question-btn" style="background:#e74c3c;color:#fff;border:none;border-radius:6px;padding:5px 14px;cursor:pointer;">Delete</button>
                        </div>
                    `;
                    div.querySelector('.edit-question-btn').onclick = function() {
                        openQuestionEditor(i);
                    };
                    div.querySelector('.delete-question-btn').onclick = function() {
                        editingQuiz.questions.splice(i, 1);
                        renderQuestionsList();
                    };
                    list.appendChild(div);
                });
            }
            // --- Add Question ---
            document.getElementById('addQuestionBtn').onclick = function() {
                openQuestionEditor();
            };
            // --- Question Editor Logic ---
            function openQuestionEditor(qIdx) {
                editingQuestionIndex = typeof qIdx === "number" ? qIdx : null;
                let q = editingQuestionIndex !== null ? editingQuiz.questions[editingQuestionIndex] : {};
                renderQuestionTypeFields(q, editingQuiz.type || "math");
                document.getElementById('questionGrade').value = q.grade || "1";
                showModal(questionEditorModal);
            }
            document.getElementById('closeQuestionEditorModal').onclick = function() {
                hideModal(questionEditorModal);
            };
            questionEditorModal.addEventListener('click', function(e) {
                if (e.target === questionEditorModal) hideModal(questionEditorModal);
            });
            // --- Render Question Type Fields ---
            function renderQuestionTypeFields(q = {}, quizType = "math") {
                const fields = document.getElementById('questionTypeFields');
                let html = "";
                // Dropdown for question type (for custom quiz)
                if (editingQuiz.type === "custom") {
                    html += `
                        <label style="font-weight:600;">Question Format:</label>
                        <select id="customQuestionFormat" style="width:180px;padding:6px 8px;border-radius:5px;border:1px solid #ccc;margin-bottom:8px;">
                            <option value="text" ${q.format==="text"?"selected":""}>Text Question</option>
                            <option value="image" ${q.format==="image"?"selected":""}>Image Question</option>
                            <option value="image-text" ${q.format==="image-text"?"selected":""}>Image & Text Question</option>
                        </select>
                    `;
                }
                // Math type
                if (editingQuiz.type === "math" || quizType === "math") {
                    html += `
                        <label style="font-weight:600;">Operation:</label>
                        <select id="mathOperation" style="width:180px;padding:6px 8px;border-radius:5px;border:1px solid #ccc;margin-bottom:8px;">
                            <option value="addition" ${q.operation==="addition"?"selected":""}>Addition</option>
                            <option value="subtraction" ${q.operation==="subtraction"?"selected":""}>Subtraction</option>
                            <option value="multiplication" ${q.operation==="multiplication"?"selected":""}>Multiplication</option>
                            <option value="division" ${q.operation==="division"?"selected":""}>Division</option>
                            <option value="fraction" ${q.operation==="fraction"?"selected":""}>Fraction</option>
                            <option value="percentage" ${q.operation==="percentage"?"selected":""}>Percentage</option>
                        </select>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <input type="number" id="mathInput1" placeholder="Number 1" style="width:90px;" value="${q.input1||""}">
                            <span id="mathOperatorSymbol">${getOperatorSymbol(q.operation||"addition")}</span>
                            <input type="number" id="mathInput2" placeholder="Number 2" style="width:90px;" value="${q.input2||""}">
                            <span>=</span>
                            <input type="text" id="mathCorrectAnswer" placeholder="Correct Answer" style="width:90px;" value="${q.answer||""}">
                        </div>
                        <div style="margin-top:8px;">
                            <label style="font-weight:600;">Options:</label>
                            <div id="mathOptionsList" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:4px;"></div>
                            <button type="button" id="addMathOptionBtn" style="margin-top:6px;background:#eae6fa;color:#7817d3;border-radius:8px;padding:5px 12px;border:none;cursor:pointer;">Add Option</button>
                        </div>
                    `;
                }
                // Image Option type
                if (editingQuiz.type === "image" || quizType === "image") {
                    html += `
                        <label style="font-weight:600;">Question Image:</label>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <input type="file" id="imageQuestionFile" accept="image/*" style="width:auto;">
                            <span style="font-size:0.9rem;color:#888;">or</span>
                            <input type="text" id="imageQuestionUrl" placeholder="Image URL" style="width:100%;" value="${q.imageUrl||""}">
                        </div>
                        <div id="imagePreview" style="margin:6px 0;"></div>
                        <label style="font-weight:600;">Question Text (optional):</label>
                        <input type="text" id="imageQuestionText" placeholder="Question text" style="width:100%;" value="${q.question||""}">
                        <div style="margin-top:8px;">
                            <label style="font-weight:600;">Options (Image Files or URLs):</label>
                            <div id="imageOptionsList" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:4px;"></div>
                            <button type="button" id="addImageOptionBtn" style="margin-top:6px;background:#eae6fa;color:#7817d3;border-radius:8px;padding:5px 12px;border:none;cursor:pointer;">Add Option</button>
                        </div>
                    `;
                }
                // Custom type
                if (editingQuiz.type === "custom" || quizType === "custom") {
                    // Add image input fields for image or image-text format
                    let format = q.format || "text";
                    html += `
                        <label style="font-weight:600;">Question:</label>
                        <input type="text" id="customQuestionText" placeholder="Question" style="width:100%;" value="${q.question||""}">
                        <div id="customImageFields" style="margin-top:8px;${format === "image" || format === "image-text" ? "" : "display:none;"}">
                            <label style="font-weight:600;">Question Image:</label>
                            <div style="display:flex;gap:8px;align-items:center;">
                                <input type="file" id="customQuestionImageFile" accept="image/*" style="width:auto;">
                                <span style="font-size:0.9rem;color:#888;">or</span>
                                <input type="text" id="customQuestionImageUrl" placeholder="Image URL" style="width:100%;" value="${q.imageUrl||""}">
                            </div>
                            <div id="customQuestionImagePreview" style="margin:6px 0;">
                                ${q.imageUrl ? `<img src="${q.imageUrl}" style="max-width:100px;max-height:60px;border-radius:6px;">` : ""}
                            </div>
                        </div>
                        <div style="margin-top:8px;">
                            <label style="font-weight:600;">Options:</label>
                            <div id="customOptionsList" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:4px;"></div>
                            <button type="button" id="addCustomOptionBtn" style="margin-top:6px;background:#eae6fa;color:#7817d3;border-radius:8px;padding:5px 12px;border:none;cursor:pointer;">Add Option</button>
                        </div>
                    `;
                }
                fields.innerHTML = html;

                // Option state for this question
                let options = Array.isArray(q.options) ? q.options.slice() : [];
                let correct = q.answer || "";

                // Helper to re-render options and attach correct answer logic
                function renderOptionsListFixed(listId, optionsArr, correctVal, isImage) {
                    const list = document.getElementById(listId);
                    if (!list) return;
                    list.innerHTML = "";
                    optionsArr.forEach((opt, i) => {
                        const btn = document.createElement('button');
                        btn.type = "button";
                        btn.style.background = opt === correctVal ? "#7817d3" : "#f7f3ff";
                        btn.style.color = opt === correctVal ? "#fff" : "#7817d3";
                        btn.style.border = "1px solid #eae6fa";
                        btn.style.borderRadius = "7px";
                        btn.style.padding = "7px 14px";
                        btn.style.fontSize = "1rem";
                        btn.style.cursor = "pointer";
                        btn.style.marginRight = "4px";
                        btn.style.position = "relative";
                        btn.onclick = function() {
                            correct = opt;
                            renderOptionsListFixed(listId, optionsArr, correct, isImage);
                        };
                        if (isImage) {
                            btn.innerHTML = `<img src="${opt}" alt="option" style="width:40px;height:40px;object-fit:cover;border-radius:4px;vertical-align:middle;">`;
                        } else {
                            btn.textContent = opt;
                        }
                        // Remove option button
                        const delBtn = document.createElement('span');
                        delBtn.textContent = "ร";
                        delBtn.style.position = "absolute";
                        delBtn.style.top = "2px";
                        delBtn.style.right = "4px";
                        delBtn.style.color = "#e74c3c";
                        delBtn.style.cursor = "pointer";
                        delBtn.onclick = function(e) {
                            e.stopPropagation();
                            optionsArr.splice(i, 1);
                            // If removed option was correct, clear correct
                            if (correct === opt) correct = "";
                            renderOptionsListFixed(listId, optionsArr, correct, isImage);
                        };
                        btn.appendChild(delBtn);
                        list.appendChild(btn);
                    });
                }

                // Math options
                if (editingQuiz.type === "math" || quizType === "math") {
                    renderOptionsListFixed('mathOptionsList', options, correct);
                    document.getElementById('addMathOptionBtn').onclick = function() {
                        showAddOptionModal(function(opt) {
                            if (opt) {
                                options.push(opt);
                                renderOptionsListFixed('mathOptionsList', options, correct);
                            }
                        });
                    };
                }
                // Image options
                if (editingQuiz.type === "image" || quizType === "image") {
                    renderOptionsListFixed('imageOptionsList', options, correct, true);
                    document.getElementById('addImageOptionBtn').onclick = function() {
                        showAddImageOptionModal(function(opt) {
                            if (opt) {
                                options.push(opt);
                                renderOptionsListFixed('imageOptionsList', options, correct, true);
                            }
                        });
                    };
                    // Image question preview logic
                    const urlInput = document.getElementById('imageQuestionUrl');
                    const fileInput = document.getElementById('imageQuestionFile');
                    const previewDiv = document.getElementById('imagePreview');
                    function updatePreview(src) {
                        previewDiv.innerHTML = src ? `<img src="${src}" style="max-width:100px;max-height:60px;border-radius:6px;">` : "";
                    }
                    if (fileInput) {
                        fileInput.addEventListener('change', function() {
                            if (fileInput.files && fileInput.files[0]) {
                                const reader = new FileReader();
                                reader.onload = function(e) {
                                    updatePreview(e.target.result);
                                    if (urlInput) urlInput.value = e.target.result;
                                };
                                reader.readAsDataURL(fileInput.files[0]);
                            }
                        });
                    }
                    if (urlInput) {
                        urlInput.addEventListener('input', function() {
                            updatePreview(urlInput.value);
                        });
                        if (urlInput.value) updatePreview(urlInput.value);
                    }
                }
                // Custom options
                if (editingQuiz.type === "custom" || quizType === "custom") {
                    renderOptionsListFixed('customOptionsList', options, correct);
                    document.getElementById('addCustomOptionBtn').onclick = function() {
                        showAddOptionModal(function(opt) {
                            if (opt) {
                                options.push(opt);
                                renderOptionsListFixed('customOptionsList', options, correct);
                            }
                        });
                    };
                    // Handle format dropdown change to show/hide image fields
                    const formatSelect = document.getElementById('customQuestionFormat');
                    if (formatSelect) {
                        formatSelect.addEventListener('change', function() {
                            const imgFields = document.getElementById('customImageFields');
                            if (imgFields) {
                                if (this.value === "image" || this.value === "image-text") {
                                    imgFields.style.display = "";
                                } else {
                                    imgFields.style.display = "none";
                                }
                            }
                        });
                    }
                    // Custom image preview logic
                    const imgUrlInput = document.getElementById('customQuestionImageUrl');
                    const imgFileInput = document.getElementById('customQuestionImageFile');
                    const imgPreviewDiv = document.getElementById('customQuestionImagePreview');
                    function updateCustomPreview(src) {
                        imgPreviewDiv.innerHTML = src ? `<img src="${src}" style="max-width:100px;max-height:60px;border-radius:6px;">` : "";
                    }
                    if (imgFileInput) {
                        imgFileInput.addEventListener('change', function() {
                            if (imgFileInput.files && imgFileInput.files[0]) {
                                const reader = new FileReader();
                                reader.onload = function(e) {
                                    updateCustomPreview(e.target.result);
                                    if (imgUrlInput) imgUrlInput.value = e.target.result;
                                };
                                reader.readAsDataURL(imgFileInput.files[0]);
                            }
                        });
                    }
                    if (imgUrlInput) {
                        imgUrlInput.addEventListener('input', function() {
                            updateCustomPreview(imgUrlInput.value);
                        });
                        if (imgUrlInput.value) updateCustomPreview(imgUrlInput.value);
                    }
                }
                // --- Operator symbol update ---
                if (document.getElementById('mathOperation')) {
                    document.getElementById('mathOperation').onchange = function() {
                        document.getElementById('mathOperatorSymbol').textContent = getOperatorSymbol(this.value);
                    };
                }
                // Save options and correct answer to the question object for use in saveQuestionBtn
                renderQuestionTypeFields._currentOptions = options;
                renderQuestionTypeFields._currentCorrect = correct;
            }
            document.getElementById('saveQuestionBtn').onclick = function(e) {
                e.preventDefault();
                let q = {};
                const grade = document.getElementById('questionGrade').value;
                q.grade = grade;
                // Math
                if (editingQuiz.type === "math") {
                    q.type = "math";
                    q.operation = document.getElementById('mathOperation').value;
                    q.input1 = document.getElementById('mathInput1').value;
                    q.input2 = document.getElementById('mathInput2').value;
                    q.question = `What is ${q.input1} ${getOperatorSymbol(q.operation)} ${q.input2}?`;
                    // Always use the correct answer from the UI state (button selection), fallback to input if not set
                    q.options = (renderQuestionTypeFields._currentOptions || []).slice();
                    q.answer = (renderQuestionTypeFields._currentCorrect !== undefined && renderQuestionTypeFields._currentCorrect !== "")
                        ? renderQuestionTypeFields._currentCorrect
                        : (document.getElementById('mathCorrectAnswer').value || (q.options.length > 0 ? q.options[0] : ""));
                }
                // Image
                else if (editingQuiz.type === "image") {
                    q.type = "image";
                    // Prefer file if present
                    let fileInput = document.getElementById('imageQuestionFile');
                    let urlInput = document.getElementById('imageQuestionUrl');
                    let imageUrl = "";
                    if (fileInput && fileInput.files && fileInput.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            imageUrl = e.target.result;
                            q.options = (renderQuestionTypeFields._currentOptions || []).slice();
                            q.answer = (renderQuestionTypeFields._currentCorrect !== undefined && renderQuestionTypeFields._currentCorrect !== "")
                                ? renderQuestionTypeFields._currentCorrect
                                : (q.options.length > 0 ? q.options[0] : "");
                            q.imageUrl = imageUrl;
                            q.question = document.getElementById('imageQuestionText').value;
                            finishSave();
                        };
                        reader.readAsDataURL(fileInput.files[0]);
                        return; // async, finishSave will be called after load
                    } else if (urlInput && urlInput.value) {
                        imageUrl = urlInput.value;
                    }
                    q.imageUrl = imageUrl;
                    q.question = document.getElementById('imageQuestionText').value;
                    q.options = (renderQuestionTypeFields._currentOptions || []).slice();
                    q.answer = (renderQuestionTypeFields._currentCorrect !== undefined && renderQuestionTypeFields._currentCorrect !== "")
                        ? renderQuestionTypeFields._currentCorrect
                        : (q.options.length > 0 ? q.options[0] : "");
                    finishSave();
                    return;
                }
                // Custom
                else if (editingQuiz.type === "custom") {
                    q.type = "custom";
                    let format = "text";
                    if (document.getElementById('customQuestionFormat')) {
                        format = document.getElementById('customQuestionFormat').value;
                    }
                    q.format = format;
                    if (format === "image" || format === "image-text") {
                        let imgFileInput = document.getElementById('customQuestionImageFile');
                        let imgUrlInput = document.getElementById('customQuestionImageUrl');
                        let imageUrl = "";
                        if (imgFileInput && imgFileInput.files && imgFileInput.files[0]) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                imageUrl = e.target.result;
                                q.imageUrl = imageUrl;
                                if (format === "image-text") {
                                    q.question = document.getElementById('customQuestionText').value;
                                } else {
                                    q.question = "";
                                }
                                q.options = (renderQuestionTypeFields._currentOptions || []).slice();
                                q.answer = (renderQuestionTypeFields._currentCorrect !== undefined && renderQuestionTypeFields._currentCorrect !== "")
                                    ? renderQuestionTypeFields._currentCorrect
                                    : (q.options.length > 0 ? q.options[0] : "");
                                finishSave();
                            };
                            reader.readAsDataURL(imgFileInput.files[0]);
                            return; // async, finishSave will be called after load
                        } else if (imgUrlInput && imgUrlInput.value) {
                            imageUrl = imgUrlInput.value;
                        }
                        q.imageUrl = imageUrl;
                        if (format === "image-text") {
                            q.question = document.getElementById('customQuestionText').value;
                        } else {
                            q.question = "";
                        }
                    } else {
                        q.question = document.getElementById('customQuestionText').value;
                        q.imageUrl = "";
                    }
                    q.options = (renderQuestionTypeFields._currentOptions || []).slice();
                    q.answer = (renderQuestionTypeFields._currentCorrect !== undefined && renderQuestionTypeFields._currentCorrect !== "")
                        ? renderQuestionTypeFields._currentCorrect
                        : (q.options.length > 0 ? q.options[0] : "");
                    finishSave();
                    return;
                }
                finishSave();

                function finishSave() {
                    // Save or update question in quiz
                    if (editingQuestionIndex !== null && editingQuestionIndex !== undefined) {
                        editingQuiz.questions[editingQuestionIndex] = q;
                    } else {
                        editingQuiz.questions = editingQuiz.questions || [];
                        editingQuiz.questions.push(q);
                    }
                    renderQuestionsList();
                    hideModal(questionEditorModal);
                }
            };
        })();

    // --- AI Assistant Modal Logic ---
    (function(){
        // Elements
        const aiIcon = document.getElementById("ai-assist");
        const aiModal = document.getElementById("aiAssistantModal");
        const closeAIModal = document.getElementById("closeAIModal");
        const aiForm = document.getElementById("aiAssistantForm");
        const aiInput = document.getElementById("aiMessageInput");
        const aiChatHistory = document.getElementById("aiChatHistory");
        const aiHistoryBtn = document.getElementById("aiHistoryBtn");
        const aiHistoryModal = document.getElementById("aiHistoryModal");
        const closeAIHistoryModal = document.getElementById("closeAIHistoryModal");
        const aiHistoryList = document.getElementById("aiHistoryList");

        // Suggestions
        const aiSuggestions = [
            "What is Math?",
            "What if you get the quiz wrong?",
            "How do I get a high score?",
            "Who are you?",
            "What is your name?",
            "Can you help me?",
            "How does the quiz work?",
            "What happens if I finish the quiz?",
            "Can you do my homework?",
            "What is 2 + 2?",
            "What is 10% of 50?",
            "Simplify 4/8",
            "What is 7 ร 8?",
            "What is 12.5% of 64?",
            "What is 1/2 + 1/4?",
            "Hi",
            "Hello",
            "Hey"
        ];

        // Create suggestions container only inside AI modal, under the input
        let sugContainer = document.createElement("div");
        sugContainer.id = "aiSuggestionsContainer";
        sugContainer.style.margin = "10px 0 0 0";
        sugContainer.style.display = "flex";
        sugContainer.style.flexWrap = "wrap";
        sugContainer.style.gap = "8px";
        sugContainer.style.overflowX = "auto";
        sugContainer.style.alignItems = "center";

        // Insert after aiForm in modal
        function insertSuggestions() {
            // Remove from DOM if already present elsewhere
            if (sugContainer.parentNode) sugContainer.parentNode.removeChild(sugContainer);
            // Only add if modal is visible
            if (aiModal && aiModal.style.display !== "none") {
                aiForm.parentNode.insertBefore(sugContainer, aiForm.nextSibling);
            }
        }

        function renderSuggestions() {
            sugContainer.innerHTML = "";
            aiSuggestions.forEach(text => {
                const btn = document.createElement("button");
                btn.type = "button";
                btn.textContent = text;
                btn.style.background = "#f7f3ff";
                btn.style.color = "#7817d3";
                btn.style.border = "1px solid #eae6fa";
                btn.style.borderRadius = "7px";
                btn.style.padding = "7px 14px";
                btn.style.fontSize = "1rem";
                btn.style.cursor = "pointer";
                btn.style.whiteSpace = "nowrap";
                btn.style.transition = "background 0.2s";
                btn.onmouseenter = () => btn.style.background = "#eae6fa";
                btn.onmouseleave = () => btn.style.background = "#f7f3ff";
                btn.onclick = () => {
                    aiInput.value = text;
                    aiInput.focus();
                };
                sugContainer.appendChild(btn);
            });
        }

        // On modal open, render suggestions
        function showAIModal() {
            aiModal.style.display = "flex";
            aiInput.value = "";
            aiCurrentSession = [];
            renderAIChat();
            renderSuggestions();
            insertSuggestions();
            setTimeout(()=>aiInput.focus(),100);
        }

        // AI Assistant state
        let aiHistory = JSON.parse(localStorage.getItem("aiAssistantHistory")||"[]");
        let aiCurrentSession = [];

        // Show/hide modal helpers
        function hideAIModal() {
            aiModal.style.display = "none";
            // Remove suggestions from DOM when modal closes
            if (sugContainer.parentNode) sugContainer.parentNode.removeChild(sugContainer);
        }
        function showAIHistoryModal() {
            aiHistoryModal.style.display = "flex";
            renderAIHistoryList();
        }
        function hideAIHistoryModal() {
            aiHistoryModal.style.display = "none";
        }

        // Attach icon click
        if(aiIcon){
            aiIcon.addEventListener("click", showAIModal);
        }
        closeAIModal.onclick = hideAIModal;
        aiModal.onclick = function(e){if(e.target===aiModal)hideAIModal();};
        aiHistoryBtn.onclick = showAIHistoryModal;
        closeAIHistoryModal.onclick = hideAIHistoryModal;
        aiHistoryModal.onclick = function(e){if(e.target===aiHistoryModal)hideAIHistoryModal();};

        // Render chat
        function renderAIChat(){
            aiChatHistory.innerHTML = "";
            aiCurrentSession.forEach(msg=>{
                const div = document.createElement("div");
                div.style.marginBottom = "8px";
                div.innerHTML = `<b style="color:#7817d3;">${msg.role==="user"?"You":"AI"}:</b> ${msg.text}`;
                aiChatHistory.appendChild(div);
            });
            aiChatHistory.scrollTop = aiChatHistory.scrollHeight;
        }

        // Render history list
        function renderAIHistoryList(){
            aiHistoryList.innerHTML = "";
            if(!aiHistory.length){
                aiHistoryList.innerHTML = "<div style='color:#888;'>No recent sessions.</div>";
                return;
            }
            aiHistory.slice(-10).reverse().forEach((session,i)=>{
                const btn = document.createElement("button");
                btn.style.display = "block";
                btn.style.width = "100%";
                btn.style.textAlign = "left";
                btn.style.background = "#f7f3ff";
                btn.style.border = "none";
                btn.style.borderRadius = "7px";
                btn.style.marginBottom = "7px";
                btn.style.padding = "8px";
                btn.style.cursor = "pointer";
                btn.innerHTML = session.map(m=>`${m.role==="user"?"<b>You:</b>":"<b>AI:</b>"} ${m.text}`).join("<br>");
                btn.onclick = function(){
                    aiCurrentSession = session.slice();
                    renderAIChat();
                    hideAIHistoryModal();
                    showAIModal();
                };
                aiHistoryList.appendChild(btn);
            });
        }

        // Math parser: only allow math, fractions, %, basic arithmetic
        function isMathQuestion(text){
            // Accepts: numbers, + - * / ร รท . ( ) % : fractions
            // Reject if contains letters not in "of", "percent", "fraction", "simplify", "as", "ratio"
            const allowedWords = ["of","percent","fraction","simplify","as","ratio"];
            const cleaned = text.toLowerCase().replace(/[^\w\s%\/\.\+\-\*\(\)รรท:]/g,"");
            const words = cleaned.split(/\s+/).filter(Boolean);
            for(let w of words){
                if(/^[a-z]+$/.test(w) && !allowedWords.includes(w)) return false;
            }
            // Must contain at least a digit or math symbol
            return /[\d\+\-\*\/รรท\.\(\)%:]/.test(text);
        }

        // Extra AI answers for common questions
        function aiExtraAnswer(text) {
            const lower = text.trim().toLowerCase();
            // Greetings
            if (/^(hi|hello|hey)[\s!,.]*$/i.test(lower)) {
                return "Hello, How I can help you math.";
            }
            // What is Math
            if (/^what\s+is\s+math[\s?]*$/i.test(lower)) {
                // Random fun fact or definition
                const facts = [
                    "Math is the study of numbers, shapes, and patterns.",
                    "Math helps us solve problems and understand the world.",
                    "Mathematics is used in science, engineering, and everyday life.",
                    "Math is about logic, reasoning, and calculation.",
                    "Math is fun! You can use it to solve puzzles and games."
                ];
                return facts[Math.floor(Math.random()*facts.length)];
            }
            // What if you get the quiz wrong
            if (/what\s+if\s+you\s+get\s+(the\s+)?quiz\s+wrong[\s?]*$/i.test(lower)) {
                return "You lose points like 3-11";
            }
            // How to get a high score
            if (/how\s+(do|can)\s+i\s+get\s+a\s+high\s+score[\s?]*$/i.test(lower)) {
                return "Answer questions correctly and quickly to get a high score!";
            }
            // Who are you
            if (/who\s+are\s+you[\s?]*$/i.test(lower)) {
                return "I am CLILI, your AI math assistant!";
            }
            // What is your name
            if (/what\s+is\s+your\s+name[\s?]*$/i.test(lower)) {
                return "My name is CLILI.";
            }
            // Can you help me
            if (/can\s+you\s+help\s+me[\s?]*$/i.test(lower)) {
                return "Of course! Ask me any math question.";
            }
            // How does the quiz work
            if (/how\s+does\s+(the\s+)?quiz\s+work[\s?]*$/i.test(lower)) {
                return "You answer math questions. Correct answers give you points, wrong answers lose points.";
            }
            // What happens if I finish the quiz
            if (/what\s+happens\s+if\s+i\s+finish\s+(the\s+)?quiz[\s?]*$/i.test(lower)) {
                return "You will see your score and a message based on your performance!";
            }
            // Can you do my homework
            if (/can\s+you\s+do\s+my\s+homework[\s?]*$/i.test(lower)) {
                return "I can help you understand math problems, but you should try to solve them yourself!";
            }
            // Default: no match
            return null;
        }

        // Math solver
        function solveMath(text){
            // Try to extract and solve simple math expressions
            let expr = text;
            // Replace ร รท with * /
            expr = expr.replace(/ร/g,"*").replace(/รท/g,"/");
            // Replace % with /100 if used as percent
            expr = expr.replace(/(\d+(\.\d+)?)\s*%/g, "($1/100)");
            // Fractions: 1/2 + 1/4 etc
            expr = expr.replace(/(\d+)\s*\/\s*(\d+)/g, "($1/$2)");
            // "of" as multiplication
            expr = expr.replace(/\bof\b/gi, "*");
            // Remove words
            expr = expr.replace(/[a-zA-Z]+/g,"");
            try{
                // eslint-disable-next-line no-eval
                let result = eval(expr);
                if(typeof result==="number" && isFinite(result)){
                    return "The answer is: <b>"+result+"</b>";
                }
                return "Sorry, I couldn't solve that math problem.";
            }catch{
                return "Sorry, I couldn't solve that math problem.";
            }
        }

        // Handle send
        aiForm.onsubmit = function(e){
            e.preventDefault();
            const text = aiInput.value.trim();
            if(!text){
                aiInput.focus();
                return;
            }
            aiCurrentSession.push({role:"user",text:text});
            renderAIChat();

            // Extra AI answers
            const aiMsg = aiExtraAnswer(text);
            if (aiMsg) {
                aiCurrentSession.push({role:"ai",text:aiMsg});
                renderAIChat();
                saveSession();
                aiInput.value = "";
                return;
            }

            // Only math allowed
            if(!isMathQuestion(text)){
                const msg = "Sorry, I can only solve Math problems";
                aiCurrentSession.push({role:"ai",text:msg});
                renderAIChat();
                saveSession();
                aiInput.value = "";
                return;
            }

            const answer = solveMath(text);
            aiCurrentSession.push({role:"ai",text:answer});
            renderAIChat();
            saveSession();

            aiInput.value = "";
        };

        // Save session to history
        function saveSession(){
            if(aiCurrentSession.length){
                aiHistory.push(aiCurrentSession.slice());
                if(aiHistory.length>20) aiHistory = aiHistory.slice(-20);
                localStorage.setItem("aiAssistantHistory",JSON.stringify(aiHistory));
            }
        }

        // Keyboard: ESC to close
        document.addEventListener("keydown",function(e){
            if(aiModal.style.display==="flex" && e.key==="Escape") hideAIModal();
            if(aiHistoryModal.style.display==="flex" && e.key==="Escape") hideAIHistoryModal();
        });

        // If theme changes, update modal color (for dynamic theme switch)
        function updateAIModalTheme(){
            const isDark = document.body.classList.contains("dark-mode");
            document.querySelectorAll('.ai-modal-content').forEach(el=>{
                if(isDark){
                    el.style.background = "#32006b";
                    el.style.color = "#e0e0e0";
                }else{
                    el.style.background = "#fff";
                    el.style.color = "#222";
                }
            });
        }
        window.addEventListener("DOMContentLoaded", function(){
            updateAIModalTheme();
            renderSuggestions();
        });
        // Listen for theme toggle
        const darkModeToggle = document.getElementById("dark-mode-toggle");
        if(darkModeToggle){
            darkModeToggle.addEventListener("click", function(){
                setTimeout(updateAIModalTheme, 100);
            });
        }
    })();
    </script>
    <div class="modal" id="adminSettingsModal">
        <div class="modal-content" style="position:relative;">
            <span id="closeModal" style="position:absolute;top:12px;right:12px;font-size:2rem;cursor:pointer;" class="material-symbols-outlined">close</span>
            <h2>Admin Settings</h2>
            <p>Here you can manage settings for the quiz.</p>
            <form id="adminSettingsForm" style="display:flex;flex-direction:column;gap:18px;margin-top:18px;">
                <div>
                    <label for="adminProfileName" style="font-weight:600;">Profile Name</label>
                    <input type="text" id="adminProfileName" maxlength="30" style="width:100%;padding:8px;margin-top:4px;border-radius:5px;border:1px solid #ccc;">
                </div>
                <div>
                    <label for="adminLanguage" style="font-weight:600;">Language</label>
                    <select id="adminLanguage" style="width:100%;padding:8px;margin-top:4px;border-radius:5px;border:1px solid #ccc;">
                        <option value="en">English</option>
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                        <option value="de">German</option>
                    </select>
                </div>
                <div>
                    <label for="adminGrade" style="font-weight:600;">Grade</label>
                    <select id="adminGrade" style="width:100%;padding:8px;margin-top:4px;border-radius:5px;border:1px solid #ccc;">
                        <option value="1">Grade 1</option>
                        <option value="2">Grade 2</option>
                        <option value="3">Grade 3</option>
                        <option value="4">Grade 4</option>
                        <option value="5">Grade 5</option>
                        <option value="6">Grade 6</option>
                        <option value="7">Grade 7</option>
                    </select>
                </div>
                <div>
                    <label for="adminPassword" style="font-weight:600;">Password</label>
                    <input type="password" id="adminPassword" maxlength="64" style="width:100%;padding:8px;margin-top:4px;border-radius:5px;border:1px solid #ccc;">
                </div>
                <div style="display:flex;align-items:center;gap:10px;">
                    <input type="checkbox" id="aiAssistantToggle" style="width:18px;height:18px;">
                    <label for="aiAssistantToggle" style="font-weight:600;cursor:pointer;">AI Assistant</label>
                </div>
                <div>
                    <button type="button" id="clearHistoryBtn" style="background:#e74c3c;color:#fff;padding:10px 18px;border:none;border-radius:8px;font-weight:600;cursor:pointer;">Clear All History</button>
                </div>
                <div style="display:flex;justify-content:flex-end;gap:10px;">
                    <button type="button" id="adminSettingsSave" style="background:#7817d3;color:#fff;padding:10px 24px;border:none;border-radius:8px;font-weight:600;cursor:pointer;">Save</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Confirm dialog for clear history -->
    <div class="modal" id="confirmClearHistoryModal" style="display:none;z-index:10002;">
        <div class="modal-content" style="max-width:340px;margin:120px auto;padding:32px 24px;border-radius:12px;box-shadow:0 4px 24px rgba(0,0,0,0.18);position:relative;">
            <h3 style="margin-top:0;">Confirm Clear History</h3>
            <p>Are you sure you want to clear all quiz history? This cannot be undone.</p>
            <div style="display:flex;gap:12px;justify-content:flex-end;margin-top:18px;">
                <button id="cancelClearHistory" style="padding:8px 18px;border-radius:6px;border:none;background:#ccc;color:#222;">Cancel</button>
                <button id="confirmClearHistory" style="padding:8px 18px;border-radius:6px;border:none;background:#e74c3c;color:#fff;">Clear</button>
            </div>
        </div>
    </div>
    <!-- The admin modal logic script block has been moved to the end of the body, after all quiz and renderQuizzes functions are defined. -->
    <script>
        

        /* --- QUIZ HISTORY LOGIC --- */

        // Render history list
        function renderHistoryList(filter = "") {
            let history = [];
            try {
                history = JSON.parse(localStorage.getItem("quizHistory") || "[]");
            } catch {}
            const list = document.getElementById("historyList");
            if (!list) return;
            list.innerHTML = "";
            let filtered = history;
            if (filter) {
                const f = filter.toLowerCase();
                filtered = history.filter(h =>
                    (h.title && h.title.toLowerCase().includes(f)) ||
                    (h.description && h.description.toLowerCase().includes(f)) ||
                    (h.date && h.date.toLowerCase().includes(f)) ||
                    (typeof h.score === "number" && h.score.toString().includes(f))
                );
            }
            if (filtered.length === 0) {
                list.innerHTML = `<div style="color:#888;">No history found.</div>`;
                return;
            }
            filtered.slice().reverse().forEach(h => {
                const div = document.createElement("div");
                div.style.background = "#fff";
                div.style.borderRadius = "10px";
                div.style.boxShadow = "0 1px 6px rgba(120,23,211,0.06)";
                div.style.padding = "16px 14px";
                div.style.marginBottom = "14px";
                div.innerHTML = `
                    <div style="font-size:1.1rem;font-weight:600;color:#7817d3;">${h.title || ""}</div>
                    <div style="font-size:0.98rem;color:#444;margin-bottom:6px;">${h.description || ""}</div>
                    <div style="font-size:0.97rem;color:#555;">
                        <b>Score:</b> ${h.score} &nbsp; 
                        <b>Date:</b> ${h.date}
                        ${h.time ? `&nbsp; <b>Time:</b> ${h.time}` : ""}
                    </div>
                `;
                list.appendChild(div);
            });
        }

        // Save quiz attempt to history
        function saveQuizHistory(quiz, score, timeTaken) {
            let history = [];
            try {
                history = JSON.parse(localStorage.getItem("quizHistory") || "[]");
            } catch {}
            history.push({
                title: quiz.title,
                description: quiz.description,
                score: score,
                date: new Date().toLocaleString(),
                time: timeTaken
            });
            localStorage.setItem("quizHistory", JSON.stringify(history));
            // Update history list immediately after saving
            if (document.getElementById("historyList")) {
                renderHistoryList();
            }
        }

        // Define a default endQuiz if not already defined to prevent ReferenceError
        if (typeof endQuiz !== "function") {
            window.endQuiz = function() {};
        }
        // Save to history when quiz ends
        const originalEndQuiz = endQuiz;
        endQuiz = function() {
            // Always save history before showing result, regardless of score
            if (currentQuiz && typeof currentScore === "number") {
                // Calculate time taken
                let elapsed = Math.floor((Date.now() - quizStartTime) / 1000);
                let min = Math.floor(elapsed / 60);
                let sec = elapsed % 60;
                let timeStr = `${min}:${sec.toString().padStart(2, "0")}`;
                saveQuizHistory(currentQuiz, currentScore, timeStr);
            }
            originalEndQuiz();
            // Update history UI if on history page
            if (document.getElementById("historyList")) renderHistoryList(document.getElementById("searchHistory").value);
        };

        // Render history on page load and when navigating to history
        window.addEventListener("DOMContentLoaded", function() {
            renderHistoryList();
            const search = document.getElementById("searchHistory");
            if (search) {
                search.value = "";
                search.addEventListener("input", function() {
                    renderHistoryList(search.value);
                });
            }
            // Also update history when switching to history tab
            document.querySelectorAll('.nav-link[data-page="historyContent"]').forEach(btn => {
                btn.addEventListener("click", function() {
                    renderHistoryList(document.getElementById("searchHistory") ? document.getElementById("searchHistory").value : "");
                });
            });
        });
        















        /* --- NAVIGATION LOGIC --- */

        // Show only the selected content section
        function showPage(pageId) {
            document.querySelectorAll('.content').forEach(c => c.style.display = 'none');
            const page = document.getElementById(pageId);
            if (page) page.style.display = 'block';
            // Save current page to sessionStorage
            sessionStorage.setItem('currentContentPage', pageId);
        }

        // On page load, restore last visited content page from sessionStorage
        window.addEventListener('DOMContentLoaded', function () {
            const lastPage = sessionStorage.getItem('currentContentPage');
            if (lastPage && document.getElementById(lastPage)) {
            showPage(lastPage);
            // Optionally, highlight active nav link
            document.querySelectorAll('.nav-link').forEach(b => b.classList.remove('active'));
            let navBtn = document.querySelector(`.nav-link[data-page="${lastPage}"]`);
            if (navBtn) navBtn.classList.add('active');
            }
        });

        // Nav link click handler
        document.querySelectorAll('.nav-link').forEach(btn => {
            btn.addEventListener('click', function () {
                showPage(this.dataset.page);
                // Optionally, highlight active link
                document.querySelectorAll('.nav-link').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // --- MOBILE MENU OVERLAY ---
        let menuOverlay = document.getElementById('menuOverlay');
        if (!menuOverlay) {
            menuOverlay = document.createElement('div');
            menuOverlay.id = 'menuOverlay';
            menuOverlay.style.display = 'none';
            menuOverlay.style.position = 'fixed';
            menuOverlay.style.top = '0';
            menuOverlay.style.left = '0';
            menuOverlay.style.width = '100vw';
            menuOverlay.style.height = '100vh';
            menuOverlay.style.background = '#4b0ae2';
            menuOverlay.style.zIndex = '20000';
            menuOverlay.style.transition = 'opacity 0.3s';
            menuOverlay.innerHTML = `
                <div style="position:absolute;top:24px;right:32px;z-index:2;">
                    <button id="closeMenuOverlay" style="background:none;border:none;color:#fff;font-size:2.2rem;cursor:pointer;">
                        <span class="material-symbols-outlined" style="font-size:2.2rem;">close</span>
                    </button>
                </div>
                <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;">
                    <button class="nav-link" data-page="homeContent" style="background:none;border:none;color:#fff;font-size:2rem;margin:18px 0;">${t("Home")}</button>
                    <button class="nav-link" data-page="historyContent" style="background:none;border:none;color:#fff;font-size:2rem;margin:18px 0;">${t("History")}</button>
                    <button class="nav-link" data-page="createContent" style="background:none;border:none;color:#fff;font-size:2rem;margin:18px 0;">${t("Create")}</button>
                    <button class="nav-link" data-page="myActivityContent" style="background:none;border:none;color:#fff;font-size:2rem;margin:18px 0;">${t("My Activity")}</button>
                </div>
            `;
            document.body.appendChild(menuOverlay);
        }

        // Show overlay on menu icon click
        document.querySelector('.menu-btn').addEventListener('click', function () {
            menuOverlay.style.display = 'block';
            setTimeout(() => { menuOverlay.style.opacity = '1'; }, 10);
        });

        // Hide overlay on X click or outside click
        function closeMenuOverlay() {
            menuOverlay.style.opacity = '0';
            setTimeout(() => { menuOverlay.style.display = 'none'; }, 300);
        }
        menuOverlay.addEventListener('click', function (e) {
            if (e.target === menuOverlay) closeMenuOverlay();
        });
        menuOverlay.querySelector('#closeMenuOverlay').addEventListener('click', closeMenuOverlay);

        // Overlay nav links: navigate and close overlay
        menuOverlay.querySelectorAll('.nav-link').forEach(btn => {
            btn.addEventListener('click', function () {
                showPage(this.dataset.page);
                closeMenuOverlay();
                // Optionally, highlight active link in main nav too
                document.querySelectorAll('.nav-link').forEach(b => b.classList.remove('active'));
                // Find and highlight the main nav link
                let mainNav = document.querySelector(`.nav-bar .nav-link[data-page="${this.dataset.page}"]`);
                if (mainNav) mainNav.classList.add('active');
            });
        });

        // Optionally, highlight Home as default on load
        window.addEventListener('DOMContentLoaded', function () {
            let firstNav = document.querySelector('.nav-link[data-page="homeContent"]');
            if (firstNav) firstNav.classList.add('active');
        });









        const translations = {
            es: {
            "Welcome to GAMERYT Math Quiz": "Bienvenido al GAMERYT Math Quiz",
            "Let a teacher if you're at school enter your name": "Si estรกs en la escuela, deja que un maestro ingrese tu nombre",
            "Enter your name (max 30 characters, teacher only)": "Ingrese su nombre (mรกx 30 caracteres, solo maestro)",
            "Next": "Siguiente",
            "Choose a Grade (Teacher can only do this)": "Elija un grado (solo maestro)",
            "Select your grade": "Seleccione su grado",
            "Choose a Language (Teacher can only do this)": "Elija un idioma (solo maestro)",
            "English": "Inglรฉs",
            "Spanish": "Espaรฑol",
            "French": "Francรฉs",
            "German": "Alemรกn",
            "Choose a Theme (You can only do this)": "Elija un tema (solo usted)",
            "Light": "Claro",
            "Dark": "Oscuro",
            "Enter a password to access settings (Teacher can only do this)": "Ingrese una contraseรฑa para acceder a la configuraciรณn (solo maestro)",
            "Enter password": "Ingrese la contraseรฑa",
            "Go": "Ir",
            "Math Quiz": "Cuestionario de matemรกticas",
            "Create": "Crear",
            "My Activity": "Mi Actividad",
            "History": "Historial",
            "Home": "Inicio",
            "Template Quizzes": "Cuestionarios de plantilla",
            "Quizzes that I Created": "Cuestionarios que he creado",
            "Completed Quizzes": "Cuestionarios completados",
            "Start Quiz": "Comenzar cuestionario",
            "No quizzes available.": "No hay cuestionarios disponibles.",
            "Admin Settings (teachers only)": "Configuraciรณn de administrador (solo maestros)",
            "Admin Settings": "Configuraciรณn de administrador",
            "Here you can manage settings for the quiz.": "Aquรญ puede administrar la configuraciรณn del cuestionario.",
            "Close": "Cerrar",
            "Quiz": "Cuestionario",
            "Your Score:": "Tu puntuaciรณn:",
            "Quiz Complete!": "ยกCuestionario completado!",
            "That's OK! You can try again.": "ยกEstรก bien! Puedes intentarlo de nuevo.",
            "Keep trying your best!": "ยกSigue intentรกndolo!",
            "Good Job!": "ยกBuen trabajo!",
            "Great Job!": "ยกGran trabajo!",
            "Try Again": "Intentar de nuevo",
            "Go Home": "Ir al inicio",
            "Please enter your name.": "Por favor, ingrese su nombre.",
            "Please select a grade.": "Por favor, seleccione un grado.",
            "Please select a language.": "Por favor, seleccione un idioma.",
            "Please select a theme.": "Por favor, seleccione un tema.",
            "Incorrect password.": "Contraseรฑa incorrecta.",
            "Enter Admin Password": "Ingrese la contraseรฑa de administrador",
            "Password": "Contraseรฑa",
            "Cancel": "Cancelar",
            "OK": "Aceptar",
            // Quiz question words
            "What": "ยฟQuรฉ",
            "is": "es",
            "of": "de",
            "Quiz Question": "Pregunta del cuestionario",
            "Correct!": "ยกCorrecto!",
            "Wrong!": "ยกIncorrecto!",
            "Correct answer:": "Respuesta correcta:",
            "Question": "Pregunta",
            "Answer": "Respuesta",
            "Score": "Puntuaciรณn",
            "Time": "Tiempo",
            "minutes": "minutos",
            "seconds": "segundos"
            },
            fr: {
            "Welcome to GAMERYT Math Quiz": "Bienvenue sur GAMERYT Math Quiz",
            "Let a teacher if you're at school enter your name": "Si vous รชtes ร l'รฉcole, laissez un enseignant entrer votre nom",
            "Enter your name (max 30 characters, teacher only)": "Entrez votre nom (30 caractรจres max, enseignant uniquement)",
            "Next": "Suivant",
            "Choose a Grade (Teacher can only do this)": "Choisissez une classe (enseignant uniquement)",
            "Select your grade": "Sรฉlectionnez votre classe",
            "Choose a Language (Teacher can only do this)": "Choisissez une langue (enseignant uniquement)",
            "English": "Anglais",
            "Spanish": "Espagnol",
            "French": "Franรงais",
            "German": "Allemand",
            "Choose a Theme (You can only do this)": "Choisissez un thรจme (vous seul)",
            "Light": "Clair",
            "Dark": "Sombre",
            "Enter a password to access settings (Teacher can only do this)": "Entrez un mot de passe pour accรฉder aux paramรจtres (enseignant uniquement)",
            "Enter password": "Entrez le mot de passe",
            "Go": "Aller",
            "Math Quiz": "Quiz de mathรฉmatiques",
            "Create": "Crรฉer",
            "My Activity": "Mon activitรฉ",
            "History": "Historique",
            "Home": "Accueil",
            "Template Quizzes": "Quiz modรจles",
            "Quizzes that I Created": "Quiz que j'ai crรฉรฉs",
            "Completed Quizzes": "Quiz terminรฉs",
            "Start Quiz": "Commencer le quiz",
            "No quizzes available.": "Aucun quiz disponible.",
            "Admin Settings (teachers only)": "Paramรจtres administrateur (enseignant uniquement)",
            "Admin Settings": "Paramรจtres administrateur",
            "Here you can manage settings for the quiz.": "Vous pouvez gรฉrer les paramรจtres du quiz ici.",
            "Close": "Fermer",
            "Quiz": "Quiz",
            "Your Score:": "Votre score :",
            "Quiz Complete!": "Quiz terminรฉ !",
            "That's OK! You can try again.": "Ce n'est pas grave ! Vous pouvez rรฉessayer.",
            "Keep trying your best!": "Continuez ร essayer !",
            "Good Job!": "Bon travail !",
            "Great Job!": "Excellent travail !",
            "Try Again": "Rรฉessayer",
            "Go Home": "Accueil",
            "Please enter your name.": "Veuillez entrer votre nom.",
            "Please select a grade.": "Veuillez sรฉlectionner une classe.",
            "Please select a language.": "Veuillez sรฉlectionner une langue.",
            "Please select a theme.": "Veuillez sรฉlectionner un thรจme.",
            "Incorrect password.": "Mot de passe incorrect.",
            "Enter Admin Password": "Entrez le mot de passe administrateur",
            "Password": "Mot de passe",
            "Cancel": "Annuler",
            "OK": "OK",
            // Quiz question words
            "What": "Quelle",
            "is": "est",
            "of": "de",
            "Quiz Question": "Question du quiz",
            "Correct!": "Correct !",
            "Wrong!": "Faux !",
            "Correct answer:": "Bonne rรฉponse :",
            "Question": "Question",
            "Answer": "Rรฉponse",
            "Score": "Score",
            "Time": "Temps",
            "minutes": "minutes",
            "seconds": "secondes"
            },
            de: {
            "Welcome to GAMERYT Math Quiz": "Willkommen beim GAMERYT Mathe-Quiz",
            "Let a teacher if you're at school enter your name": "Wenn Sie in der Schule sind, lassen Sie einen Lehrer Ihren Namen eingeben",
            "Enter your name (max 30 characters, teacher only)": "Geben Sie Ihren Namen ein (max. 30 Zeichen, nur Lehrer)",
            "Next": "Weiter",
            "Choose a Grade (Teacher can only do this)": "Wรคhlen Sie eine Klasse (nur Lehrer)",
            "Select your grade": "Wรคhlen Sie Ihre Klasse",
            "Choose a Language (Teacher can only do this)": "Wรคhlen Sie eine Sprache (nur Lehrer)",
            "English": "Englisch",
            "Spanish": "Spanisch",
            "French": "Franzรถsisch",
            "German": "Deutsch",
            "Choose a Theme (You can only do this)": "Wรคhlen Sie ein Thema (nur Sie)",
            "Light": "Hell",
            "Dark": "Dunkel",
            "Enter a password to access settings (Teacher can only do this)": "Geben Sie ein Passwort ein, um auf die Einstellungen zuzugreifen (nur Lehrer)",
            "Enter password": "Passwort eingeben",
            "Go": "Los",
            "Home": "Startseite",
            "History": "Verlauf",
            "Create": "Erstellen",
            "My Activity": "Meine Aktivitรคten",
            "Math Quiz": "Mathe-Quiz",
            "Template Quizzes": "Vorlagen-Quiz",
            "Quizzes that I Created": "Von mir erstellte Quiz",
            "Completed Quizzes": "Abgeschlossene Quiz",
            "Start Quiz": "Quiz starten",
            "No quizzes available.": "Keine Quiz verfรผgbar.",
            "Admin Settings (teachers only)": "Admin-Einstellungen (nur Lehrer)",
            "Admin Settings": "Admin-Einstellungen",
            "Here you can manage settings for the quiz.": "Hier kรถnnen Sie die Einstellungen fรผr das Quiz verwalten.",
            "Close": "Schlieรen",
            "Quiz": "Quiz",
            "Your Score:": "Ihre Punktzahl:",
            "Quiz Complete!": "Quiz abgeschlossen!",
            "That's OK! You can try again.": "Das ist in Ordnung! Sie kรถnnen es erneut versuchen.",
            "Keep trying your best!": "Versuchen Sie es weiter!",
            "Good Job!": "Gute Arbeit!",
            "Great Job!": "Tolle Arbeit!",
            "Try Again": "Erneut versuchen",
            "Go Home": "Zur Startseite",
            "Please enter your name.": "Bitte geben Sie Ihren Namen ein.",
            "Please select a grade.": "Bitte wรคhlen Sie eine Klasse.",
            "Please select a language.": "Bitte wรคhlen Sie eine Sprache.",
            "Please select a theme.": "Bitte wรคhlen Sie ein Thema.",
            "Incorrect password.": "Falsches Passwort.",
            "Enter Admin Password": "Admin-Passwort eingeben",
            "Password": "Passwort",
            "Cancel": "Abbrechen",
            "OK": "OK",
            // Quiz question words
            "What": "Was",
            "is": "ist",
            "of": "von",
            "Quiz Question": "Quizfrage",
            "Correct!": "Richtig!",
            "Wrong!": "Falsch!",
            "Correct answer:": "Richtige Antwort:",
            "Question": "Frage",
            "Answer": "Antwort",
            "Score": "Punktzahl",
            "Time": "Zeit",
            "minutes": "Minuten",
            "seconds": "Sekunden"
            }
        };

        // Get current language from profile or default to English
        function getCurrentLanguage() {
            let profile = localStorage.getItem("schoolProfile");
            if (profile) {
                try {
                    let lang = JSON.parse(profile).language;
                    if (lang && lang !== "en") return lang;
                } catch {}
            }
            return "en";
        }

        // Translate a string if translation exists
        function t(str) {
            const lang = getCurrentLanguage();
            if (lang === "en") return str;
            if (translations[lang] && translations[lang][str]) return translations[lang][str];
            return str;
        }

        // Translate static UI text on page load and when language changes
        function translateStaticUI() {
            // Map of selectors to translation keys
            const map = [
            { selector: ".first h2", key: "Welcome to GAMERYT Math Quiz" },
            { selector: ".first p", key: "Let a teacher if you're at school enter your name" },
            { selector: "#nameInput", attr: "placeholder", key: "Enter your name (max 30 characters, teacher only)" },
            { selector: "#nextButton", key: "Next" },
            { selector: ".next h2", key: "Choose a Grade (Teacher can only do this)" },
            { selector: "#gradeSelect option[value='']", key: "Select your grade" },
            { selector: "#startQuizButton", key: "Next" },
            { selector: ".third h2", key: "Choose a Language (Teacher can only do this)" },
            { selector: "#languageSelect option[value='en']", key: "English" },
            { selector: "#languageSelect option[value='es']", key: "Spanish" },
            { selector: "#languageSelect option[value='fr']", key: "French" },
            { selector: "#languageSelect option[value='de']", key: "German" },
            { selector: "#languageButton", key: "Next" },
            { selector: ".fourth h2", key: "Choose a Theme (You can only do this)" },
            { selector: "#themeSelect option[value='light']", key: "Light" },
            { selector: "#themeSelect option[value='dark']", key: "Dark" },
            { selector: "#themeButton", key: "Next" },
            { selector: ".fifth h2", key: "Enter a password to access settings (Teacher can only do this)" },
            { selector: "#passwordInput", attr: "placeholder", key: "Enter password" },
            { selector: "#submitPasswordButton", key: "Go" },
            { selector: ".logo-text", key: "Math Quiz" },
            { selector: ".nav-link[data-page='homeContent']", key: "Home" },
            { selector: ".nav-link[data-page='historyContent']", key: "History" },
            { selector: ".nav-link[data-page='createContent']", key: "Create" },
            { selector: ".nav-link[data-page='myActivityContent']", key: "My Activity" },
            { selector: "#profileName", key: "" }, // Will be set dynamically
            { selector: ".content h1", key: "Home" },
            { selector: ".quiz-screen p", key: "Your Score:" },
            { selector: ".quiz-screen h2", key: "Quiz Complete!" },
            { selector: ".quiz-screen .message.ok", key: "Well done! You have completed the quiz." },
            { selector: ".content h3:nth-of-type(1)", key: "Template Quizzes" },
            { selector: ".content h3:nth-of-type(2)", key: "Quizzes that I Created" },
            { selector: ".content h3:nth-of-type(3)", key: "Completed Quizzes" },
            { selector: ".profile-menu .item#adminSettings", key: "Admin Settings (teachers only)" },
            { selector: ".quiz-screen h2", key: "Quiz" },
            { selector: "#adminSettingsModal h2", key: "Admin Settings" },
            { selector: "#adminSettingsModal p", key: "Here you can manage settings for the quiz." },
            { selector: "#closeModal", key: "Close" }
            ];

            map.forEach(item => {
            const el = document.querySelector(item.selector);
            if (el) {
                if (item.attr) {
                el.setAttribute(item.attr, t(item.key));
                } else {
                el.textContent = t(item.key);
                }
            }
            });

            // Translate quiz start buttons and empty states
            document.querySelectorAll(".start-quiz-btn").forEach(btn => btn.textContent = t("Start Quiz"));
            document.querySelectorAll("#quiz-temp, #quiz-created, #quiz-completed").forEach(container => {
            if (container && container.innerHTML.includes("No quizzes available.")) {
                container.innerHTML = `<p>${t("No quizzes available.")}</p>`;
            }
            });

            // Translate "Question", "What", "is", "of" in quiz questions
            document.querySelectorAll(".quiz-question").forEach(qDiv => {
                // Translate "Question" label if present
                qDiv.innerHTML = qDiv.innerHTML
                    .replace(/\bQuestion\b/g, t("Question"))
                    .replace(/\bWhat\b/g, t("What"))
                    .replace(/\bis\b/g, t("is"))
                    .replace(/\bof\b/g, t("of"));
            });
        }
            
        // Translate UI on page load and after profile/language change
        window.addEventListener("DOMContentLoaded", translateStaticUI);

        // When language changes, update profile and re-translate UI
        document.getElementById("languageButton").addEventListener("click", function() {
            var language = document.getElementById("languageSelect").value;
            if (language) {
                // Update profile in localStorage
                var profile = localStorage.getItem("schoolProfile");
                if (profile) {
                    try {
                        var profileObj = JSON.parse(profile);
                        profileObj.language = language;
                        localStorage.setItem("schoolProfile", JSON.stringify(profileObj));
                    } catch {}
                }
                translateStaticUI();
            }
        });

        // Also translate UI after submitting password (profile creation)
        document.getElementById("submitPasswordButton").addEventListener("click", function() {
            translateStaticUI();
        });

        // Use t() for all toast and UI messages
        // Example: showToast(t("Please enter your name."));







    // Fisher-Yates shuffle for randomizing options
    function shuffle(array) {
        let arr = array.slice();
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }
    document.addEventListener("DOMContentLoaded", function() {
        // Initialize quiz templates
        const quizTemp = [
            {
                title: "Basic Math Quiz",
                questions: [
                    // Grade 1: 14 easy addition and subtraction
                    { question: "What is 2 + 3?", options: ["4", "5", "6"], answer: "5", grade: 1 },
                    { question: "What is 7 - 2?", options: ["5", "4", "6"], answer: "5", grade: 1 },
                    { question: "What is 1 + 6?", options: ["6", "7", "8"], answer: "7", grade: 1 },
                    { question: "What is 4 + 5?", options: ["8", "9", "10"], answer: "9", grade: 1 },
                    { question: "What is 8 - 3?", options: ["4", "5", "6"], answer: "5", grade: 1 },
                    { question: "What is 6 + 2?", options: ["7", "8", "9"], answer: "8", grade: 1 },
                    { question: "What is 9 - 4?", options: ["5", "6", "4"], answer: "5", grade: 1 },
                    { question: "What is 3 + 3?", options: ["5", "6", "7"], answer: "6", grade: 1 },
                    { question: "What is 10 - 7?", options: ["2", "3", "4"], answer: "3", grade: 1 },
                    { question: "What is 5 + 2?", options: ["6", "7", "8"], answer: "7", grade: 1 },
                    { question: "What is 8 - 6?", options: ["1", "2", "3"], answer: "2", grade: 1 },
                    { question: "What is 4 + 4?", options: ["7", "8", "9"], answer: "8", grade: 1 },
                    { question: "What is 7 - 5?", options: ["1", "2", "3"], answer: "2", grade: 1 },
                    { question: "What is 2 + 5?", options: ["6", "7", "8"], answer: "7", grade: 1 },

                    // Grade 2: 14 harder addition/subtraction, easy multiplication
                    { question: "What is 15 - 7?", options: ["7", "8", "9"], answer: "8", grade: 2 },
                    { question: "What is 9 + 8?", options: ["16", "17", "18"], answer: "17", grade: 2 },
                    { question: "What is 3 ร 2?", options: ["5", "6", "7"], answer: "6", grade: 2 },
                    { question: "What is 12 + 9?", options: ["20", "21", "22"], answer: "21", grade: 2 },
                    { question: "What is 18 - 6?", options: ["11", "12", "13"], answer: "12", grade: 2 },
                    { question: "What is 4 ร 3?", options: ["12", "13", "14"], answer: "12", grade: 2 },
                    { question: "What is 20 - 8?", options: ["11", "12", "13"], answer: "12", grade: 2 },
                    { question: "What is 7 ร 2?", options: ["14", "12", "13"], answer: "14", grade: 2 },
                    { question: "What is 13 + 5?", options: ["17", "18", "19"], answer: "18", grade: 2 },
                    { question: "What is 16 - 9?", options: ["6", "7", "8"], answer: "7", grade: 2 },
                    { question: "What is 5 ร 3?", options: ["15", "16", "14"], answer: "15", grade: 2 },
                    { question: "What is 11 + 7?", options: ["17", "18", "19"], answer: "18", grade: 2 },
                    { question: "What is 14 - 5?", options: ["8", "9", "10"], answer: "9", grade: 2 },
                    { question: "What is 6 ร 2?", options: ["12", "13", "14"], answer: "12", grade: 2 },

                    // Grade 3: 14 easy division, hard addition/subtraction, normal multiplication
                    { question: "What is 36 รท 6?", options: ["5", "6", "7"], answer: "6", grade: 3 },
                    { question: "What is 27 + 18?", options: ["45", "44", "46"], answer: "45", grade: 3 },
                    { question: "What is 54 รท 9?", options: ["5", "6", "7"], answer: "6", grade: 3 },
                    { question: "What is 23 + 19?", options: ["41", "42", "43"], answer: "42", grade: 3 },
                    { question: "What is 42 รท 7?", options: ["5", "6", "7"], answer: "6", grade: 3 },
                    { question: "What is 38 - 17?", options: ["20", "21", "22"], answer: "21", grade: 3 },
                    { question: "What is 8 ร 4?", options: ["32", "30", "34"], answer: "32", grade: 3 },
                    { question: "What is 63 รท 9?", options: ["6", "7", "8"], answer: "7", grade: 3 },
                    { question: "What is 29 + 16?", options: ["44", "45", "46"], answer: "45", grade: 3 },
                    { question: "What is 56 รท 8?", options: ["6", "7", "8"], answer: "7", grade: 3 },
                    { question: "What is 35 - 18?", options: ["16", "17", "18"], answer: "17", grade: 3 },
                    { question: "What is 7 ร 5?", options: ["35", "36", "37"], answer: "35", grade: 3 },
                    { question: "What is 48 รท 6?", options: ["7", "8", "9"], answer: "8", grade: 3 },
                    { question: "What is 24 + 21?", options: ["44", "45", "46"], answer: "45", grade: 3 },

                    // Grade 4: 14 multiplication and division
                    { question: "What is 12 ร 4?", options: ["48", "44", "52"], answer: "48", grade: 4 },
                    { question: "What is 56 รท 7?", options: ["6", "7", "8"], answer: "8", grade: 4 },
                    { question: "What is 15 ร 3?", options: ["45", "40", "35"], answer: "45", grade: 4 },
                    { question: "What is 81 รท 9?", options: ["8", "9", "10"], answer: "9", grade: 4 },
                    { question: "What is 14 ร 2?", options: ["26", "28", "30"], answer: "28", grade: 4 },
                    { question: "What is 64 รท 8?", options: ["7", "8", "9"], answer: "8", grade: 4 },
                    { question: "What is 9 ร 6?", options: ["54", "56", "58"], answer: "54", grade: 4 },
                    { question: "What is 72 รท 8?", options: ["8", "9", "10"], answer: "9", grade: 4 },
                    { question: "What is 13 ร 3?", options: ["39", "36", "33"], answer: "39", grade: 4 },
                    { question: "What is 90 รท 10?", options: ["8", "9", "10"], answer: "9", grade: 4 },
                    { question: "What is 11 ร 4?", options: ["44", "45", "46"], answer: "44", grade: 4 },
                    { question: "What is 100 รท 5?", options: ["20", "25", "15"], answer: "20", grade: 4 },
                    { question: "What is 8 ร 7?", options: ["54", "56", "58"], answer: "56", grade: 4 },
                    { question: "What is 84 รท 7?", options: ["11", "12", "13"], answer: "12", grade: 4 },

                    // Grade 5: 14 larger numbers, decimals
                    { question: "What is 125 + 375?", options: ["400", "500", "450"], answer: "500", grade: 5 },
                    { question: "What is 12.5 ร 2?", options: ["25", "24", "22"], answer: "25", grade: 5 },
                    { question: "What is 250 - 125?", options: ["100", "125", "150"], answer: "125", grade: 5 },
                    { question: "What is 45.6 + 54.4?", options: ["100", "99", "101"], answer: "100", grade: 5 },
                    { question: "What is 300 รท 12?", options: ["25", "24", "23"], answer: "25", grade: 5 },
                    { question: "What is 15.5 ร 3?", options: ["45.5", "46.5", "47.5"], answer: "46.5", grade: 5 },
                    { question: "What is 500 - 275?", options: ["225", "235", "250"], answer: "225", grade: 5 },
                    { question: "What is 60.2 + 39.8?", options: ["99", "100", "101"], answer: "100", grade: 5 },
                    { question: "What is 144 รท 12?", options: ["11", "12", "13"], answer: "12", grade: 5 },
                    { question: "What is 22.5 ร 2?", options: ["44", "45", "46"], answer: "45", grade: 5 },
                    { question: "What is 800 - 350?", options: ["450", "400", "500"], answer: "450", grade: 5 },
                    { question: "What is 33.3 + 66.7?", options: ["99", "100", "101"], answer: "100", grade: 5 },
                    { question: "What is 180 รท 9?", options: ["19", "20", "21"], answer: "20", grade: 5 },
                    { question: "What is 17.5 ร 4?", options: ["70", "68", "72"], answer: "70", grade: 5 },

                    // Grade 6: 14 fractions and ratios
                    { question: "What is 1/2 + 1/4?", options: ["3/4", "2/4", "1/2"], answer: "3/4", grade: 6 },
                    { question: "What is 2/3 + 1/3?", options: ["1", "2/3", "3/4"], answer: "1", grade: 6 },
                    { question: "What is 3/5 - 1/5?", options: ["2/5", "1/5", "3/5"], answer: "2/5", grade: 6 },
                    { question: "What is 1/4 ร 2?", options: ["1/2", "1/4", "2/4"], answer: "1/2", grade: 6 },
                    { question: "What is 2/3 ร 3?", options: ["2", "1", "3"], answer: "2", grade: 6 },
                    { question: "What is 3/4 รท 3?", options: ["1/4", "1/3", "1/2"], answer: "1/4", grade: 6 },
                    { question: "What is 2:3 as a fraction?", options: ["2/3", "3/2", "1/2"], answer: "2/3", grade: 6 },
                    { question: "What is 1/5 + 2/5?", options: ["3/5", "2/5", "1/5"], answer: "3/5", grade: 6 },
                    { question: "What is 4/8 simplified?", options: ["1/2", "2/4", "1/4"], answer: "1/2", grade: 6 },
                    { question: "What is 5/6 - 1/6?", options: ["2/3", "4/6", "5/6"], answer: "2/3", grade: 6 },
                    { question: "What is 2/7 ร 7?", options: ["2", "1", "7"], answer: "2", grade: 6 },
                    { question: "What is 3/9 simplified?", options: ["1/3", "1/2", "1/4"], answer: "1/3", grade: 6 },
                    { question: "What is 1/2 of 10?", options: ["5", "4", "6"], answer: "5", grade: 6 },
                    { question: "What is 2/5 of 20?", options: ["8", "6", "10"], answer: "8", grade: 6 },

                    // Grade 7: 14 percentages
                    { question: "What is 20% of 150?", options: ["30", "25", "20"], answer: "30", grade: 7 },
                    { question: "What is 50% of 80?", options: ["40", "30", "50"], answer: "40", grade: 7 },
                    { question: "What is 10% of 200?", options: ["20", "10", "30"], answer: "20", grade: 7 },
                    { question: "What is 25% of 60?", options: ["15", "20", "10"], answer: "15", grade: 7 },
                    { question: "What is 75% of 40?", options: ["30", "25", "35"], answer: "30", grade: 7 },
                    { question: "What is 5% of 300?", options: ["15", "10", "20"], answer: "15", grade: 7 },
                    { question: "What is 60% of 90?", options: ["54", "45", "60"], answer: "54", grade: 7 },
                    { question: "What is 80% of 50?", options: ["40", "35", "45"], answer: "40", grade: 7 },
                    { question: "What is 30% of 120?", options: ["36", "30", "40"], answer: "36", grade: 7 },
                    { question: "What is 12.5% of 64?", options: ["8", "6", "10"], answer: "8", grade: 7 },
                    { question: "What is 33% of 90?", options: ["30", "27", "33"], answer: "30", grade: 7 },
                    { question: "What is 40% of 70?", options: ["28", "30", "25"], answer: "28", grade: 7 },
                    { question: "What is 90% of 110?", options: ["99", "100", "90"], answer: "99", grade: 7 },
                    { question: "What is 15% of 200?", options: ["30", "25", "35"], answer: "30", grade: 7 }
                ],
                method: "addition subtraction multiplication division fractions percentages",
                description: "A simple quiz on basic addition, subtraction, multiplication, division, fractions, and percentages."
            },
            {
                title: "Easy Math Quiz",
                questions: [
                    // Grade 1: 24 easy addition/subtraction
                    { question: "What is 1 + 1?", options: ["1", "2", "3"], answer: "2", grade: 1 },
                    { question: "What is 2 + 2?", options: ["3", "4", "5"], answer: "4", grade: 1 },
                    { question: "What is 3 - 1?", options: ["1", "2", "3"], answer: "2", grade: 1 },
                    { question: "What is 5 - 2?", options: ["2", "3", "4"], answer: "3", grade: 1 },
                    { question: "What is 4 + 1?", options: ["4", "5", "6"], answer: "5", grade: 1 },
                    { question: "What is 6 - 3?", options: ["2", "3", "4"], answer: "3", grade: 1 },
                    { question: "What is 2 + 3?", options: ["4", "5", "6"], answer: "5", grade: 1 },
                    { question: "What is 7 - 5?", options: ["1", "2", "3"], answer: "2", grade: 1 },
                    { question: "What is 3 + 2?", options: ["4", "5", "6"], answer: "5", grade: 1 },
                    { question: "What is 8 - 6?", options: ["1", "2", "3"], answer: "2", grade: 1 },
                    { question: "What is 4 + 2?", options: ["5", "6", "7"], answer: "6", grade: 1 },
                    { question: "What is 5 - 3?", options: ["1", "2", "3"], answer: "2", grade: 1 },
                    { question: "What is 7 + 1?", options: ["7", "8", "9"], answer: "8", grade: 1 },
                    { question: "What is 9 - 4?", options: ["4", "5", "6"], answer: "5", grade: 1 },
                    { question: "What is 2 + 4?", options: ["5", "6", "7"], answer: "6", grade: 1 },
                    { question: "What is 6 - 2?", options: ["3", "4", "5"], answer: "4", grade: 1 },
                    { question: "What is 3 + 4?", options: ["6", "7", "8"], answer: "7", grade: 1 },
                    { question: "What is 10 - 8?", options: ["1", "2", "3"], answer: "2", grade: 1 },
                    { question: "What is 1 + 5?", options: ["5", "6", "7"], answer: "6", grade: 1 },
                    { question: "What is 8 - 3?", options: ["4", "5", "6"], answer: "5", grade: 1 },
                    { question: "What is 2 + 5?", options: ["6", "7", "8"], answer: "7", grade: 1 },
                    { question: "What is 7 - 2?", options: ["4", "5", "6"], answer: "5", grade: 1 },
                    { question: "What is 4 + 3?", options: ["6", "7", "8"], answer: "7", grade: 1 },
                    { question: "What is 9 - 7?", options: ["1", "2", "3"], answer: "2", grade: 1 },

                    // Grade 2: 24 easy addition/subtraction
                    { question: "What is 10 + 5?", options: ["14", "15", "16"], answer: "15", grade: 2 },
                    { question: "What is 12 - 7?", options: ["4", "5", "6"], answer: "5", grade: 2 },
                    { question: "What is 8 + 4?", options: ["11", "12", "13"], answer: "12", grade: 2 },
                    { question: "What is 15 - 9?", options: ["5", "6", "7"], answer: "6", grade: 2 },
                    { question: "What is 7 + 6?", options: ["12", "13", "14"], answer: "13", grade: 2 },
                    { question: "What is 14 - 8?", options: ["5", "6", "7"], answer: "6", grade: 2 },
                    { question: "What is 9 + 5?", options: ["13", "14", "15"], answer: "14", grade: 2 },
                    { question: "What is 16 - 7?", options: ["8", "9", "10"], answer: "9", grade: 2 },
                    { question: "What is 11 + 3?", options: ["13", "14", "15"], answer: "14", grade: 2 },
                    { question: "What is 13 - 6?", options: ["6", "7", "8"], answer: "7", grade: 2 },
                    { question: "What is 6 + 7?", options: ["12", "13", "14"], answer: "13", grade: 2 },
                    { question: "What is 17 - 8?", options: ["8", "9", "10"], answer: "9", grade: 2 },
                    { question: "What is 8 + 7?", options: ["14", "15", "16"], answer: "15", grade: 2 },
                    { question: "What is 18 - 9?", options: ["8", "9", "10"], answer: "9", grade: 2 },
                    { question: "What is 10 + 8?", options: ["17", "18", "19"], answer: "18", grade: 2 },
                    { question: "What is 19 - 7?", options: ["11", "12", "13"], answer: "12", grade: 2 },
                    { question: "What is 7 + 8?", options: ["14", "15", "16"], answer: "15", grade: 2 },
                    { question: "What is 15 - 6?", options: ["8", "9", "10"], answer: "9", grade: 2 },
                    { question: "What is 9 + 8?", options: ["16", "17", "18"], answer: "17", grade: 2 },
                    { question: "What is 16 - 8?", options: ["7", "8", "9"], answer: "8", grade: 2 },
                    { question: "What is 12 + 7?", options: ["18", "19", "20"], answer: "19", grade: 2 },
                    { question: "What is 14 - 5?", options: ["8", "9", "10"], answer: "9", grade: 2 },
                    { question: "What is 11 + 6?", options: ["16", "17", "18"], answer: "17", grade: 2 },
                    { question: "What is 13 - 8?", options: ["4", "5", "6"], answer: "5", grade: 2 },

                    // Grade 3: 24 easy multiplication/division
                    { question: "What is 2 ร 3?", options: ["5", "6", "7"], answer: "6", grade: 3 },
                    { question: "What is 12 รท 4?", options: ["2", "3", "4"], answer: "3", grade: 3 },
                    { question: "What is 3 ร 4?", options: ["11", "12", "13"], answer: "12", grade: 3 },
                    { question: "What is 16 รท 2?", options: ["7", "8", "9"], answer: "8", grade: 3 },
                    { question: "What is 5 ร 2?", options: ["10", "11", "12"], answer: "10", grade: 3 },
                    { question: "What is 18 รท 3?", options: ["5", "6", "7"], answer: "6", grade: 3 },
                    { question: "What is 4 ร 3?", options: ["11", "12", "13"], answer: "12", grade: 3 },
                    { question: "What is 20 รท 5?", options: ["3", "4", "5"], answer: "4", grade: 3 },
                    { question: "What is 6 ร 2?", options: ["11", "12", "13"], answer: "12", grade: 3 },
                    { question: "What is 24 รท 4?", options: ["5", "6", "7"], answer: "6", grade: 3 },
                    { question: "What is 7 ร 1?", options: ["6", "7", "8"], answer: "7", grade: 3 },
                    { question: "What is 9 รท 3?", options: ["2", "3", "4"], answer: "3", grade: 3 },
                    { question: "What is 8 ร 2?", options: ["15", "16", "17"], answer: "16", grade: 3 },
                    { question: "What is 21 รท 7?", options: ["2", "3", "4"], answer: "3", grade: 3 },
                    { question: "What is 4 ร 5?", options: ["19", "20", "21"], answer: "20", grade: 3 },
                    { question: "What is 36 รท 6?", options: ["5", "6", "7"], answer: "6", grade: 3 },
                    { question: "What is 3 ร 6?", options: ["17", "18", "19"], answer: "18", grade: 3 },
                    { question: "What is 32 รท 8?", options: ["3", "4", "5"], answer: "4", grade: 3 },
                    { question: "What is 7 ร 2?", options: ["13", "14", "15"], answer: "14", grade: 3 },
                    { question: "What is 45 รท 9?", options: ["4", "5", "6"], answer: "5", grade: 3 },
                    { question: "What is 10 ร 2?", options: ["19", "20", "21"], answer: "20", grade: 3 },
                    { question: "What is 18 รท 3?", options: ["5", "6", "7"], answer: "6", grade: 3 },
                    { question: "What is 5 ร 3?", options: ["14", "15", "16"], answer: "15", grade: 3 },
                    { question: "What is 27 รท 3?", options: ["8", "9", "10"], answer: "9", grade: 3 },

                    // Grade 4: 24 easy multiplication/division
                    { question: "What is 6 ร 4?", options: ["23", "24", "25"], answer: "24", grade: 4 },
                    { question: "What is 48 รท 6?", options: ["7", "8", "9"], answer: "8", grade: 4 },
                    { question: "What is 7 ร 3?", options: ["20", "21", "22"], answer: "21", grade: 4 },
                    { question: "What is 56 รท 7?", options: ["7", "8", "9"], answer: "8", grade: 4 },
                    { question: "What is 8 ร 5?", options: ["39", "40", "41"], answer: "40", grade: 4 },
                    { question: "What is 72 รท 8?", options: ["8", "9", "10"], answer: "9", grade: 4 },
                    { question: "What is 9 ร 4?", options: ["35", "36", "37"], answer: "36", grade: 4 },
                    { question: "What is 81 รท 9?", options: ["8", "9", "10"], answer: "9", grade: 4 },
                    { question: "What is 10 ร 3?", options: ["29", "30", "31"], answer: "30", grade: 4 },
                    { question: "What is 90 รท 10?", options: ["8", "9", "10"], answer: "9", grade: 4 },
                    { question: "What is 11 ร 2?", options: ["21", "22", "23"], answer: "22", grade: 4 },
                    { question: "What is 100 รท 5?", options: ["20", "25", "15"], answer: "20", grade: 4 },
                    { question: "What is 12 ร 2?", options: ["23", "24", "25"], answer: "24", grade: 4 },
                    { question: "What is 96 รท 8?", options: ["11", "12", "13"], answer: "12", grade: 4 },
                    { question: "What is 13 ร 3?", options: ["38", "39", "40"], answer: "39", grade: 4 },
                    { question: "What is 104 รท 8?", options: ["12", "13", "14"], answer: "13", grade: 4 },
                    { question: "What is 14 ร 2?", options: ["27", "28", "29"], answer: "28", grade: 4 },
                    { question: "What is 112 รท 8?", options: ["13", "14", "15"], answer: "14", grade: 4 },
                    { question: "What is 15 ร 2?", options: ["29", "30", "31"], answer: "30", grade: 4 },
                    { question: "What is 120 รท 8?", options: ["14", "15", "16"], answer: "15", grade: 4 },
                    { question: "What is 16 ร 2?", options: ["31", "32", "33"], answer: "32", grade: 4 },
                    { question: "What is 128 รท 8?", options: ["15", "16", "17"], answer: "16", grade: 4 },
                    { question: "What is 17 ร 2?", options: ["33", "34", "35"], answer: "34", grade: 4 },
                    { question: "What is 136 รท 8?", options: ["16", "17", "18"], answer: "17", grade: 4 },

                    // Grade 5: 24 easy decimals
                    { question: "What is 1.5 + 2.5?", options: ["3", "4", "5"], answer: "4", grade: 5 },
                    { question: "What is 5.0 - 2.0?", options: ["2", "3", "4"], answer: "3", grade: 5 },
                    { question: "What is 2.2 + 1.8?", options: ["3.8", "4", "4.2"], answer: "4", grade: 5 },
                    { question: "What is 6.5 - 1.5?", options: ["4", "5", "6"], answer: "5", grade: 5 },
                    { question: "What is 3.0 + 2.0?", options: ["4", "5", "6"], answer: "5", grade: 5 },
                    { question: "What is 7.2 - 2.2?", options: ["4", "5", "6"], answer: "5", grade: 5 },
                    { question: "What is 4.5 + 1.5?", options: ["5", "6", "7"], answer: "6", grade: 5 },
                    { question: "What is 8.0 - 3.0?", options: ["4", "5", "6"], answer: "5", grade: 5 },
                    { question: "What is 2.5 + 2.5?", options: ["4", "5", "6"], answer: "5", grade: 5 },
                    { question: "What is 9.0 - 4.0?", options: ["4", "5", "6"], answer: "5", grade: 5 },
                    { question: "What is 5.5 + 0.5?", options: ["5", "6", "7"], answer: "6", grade: 5 },
                    { question: "What is 10.0 - 5.0?", options: ["4", "5", "6"], answer: "5", grade: 5 },
                    { question: "What is 1.2 + 3.8?", options: ["4.8", "5", "5.2"], answer: "5", grade: 5 },
                    { question: "What is 7.5 - 2.5?", options: ["4", "5", "6"], answer: "5", grade: 5 },
                    { question: "What is 2.7 + 2.3?", options: ["4.9", "5", "5.1"], answer: "5", grade: 5 },
                    { question: "What is 8.5 - 3.5?", options: ["4", "5", "6"], answer: "5", grade: 5 },
                    { question: "What is 3.3 + 1.7?", options: ["4.8", "5", "5.2"], answer: "5", grade: 5 },
                    { question: "What is 9.5 - 4.5?", options: ["4", "5", "6"], answer: "5", grade: 5 },
                    { question: "What is 4.8 + 0.2?", options: ["4.9", "5", "5.1"], answer: "5", grade: 5 },
                    { question: "What is 10.5 - 5.5?", options: ["4", "5", "6"], answer: "5", grade: 5 },
                    { question: "What is 2.4 + 2.6?", options: ["4.9", "5", "5.1"], answer: "5", grade: 5 },
                    { question: "What is 8.8 - 3.8?", options: ["4", "5", "6"], answer: "5", grade: 5 },
                    { question: "What is 3.6 + 1.4?", options: ["4.8", "5", "5.2"], answer: "5", grade: 5 },
                    { question: "What is 7.9 - 2.9?", options: ["4", "5", "6"], answer: "5", grade: 5 },

                    // Grade 6: 24 easy fractions
                    { question: "What is 1/2 + 1/2?", options: ["1", "2", "3/2"], answer: "1", grade: 6 },
                    { question: "What is 2/3 + 1/3?", options: ["1", "2/3", "3/4"], answer: "1", grade: 6 },
                    { question: "What is 3/4 - 1/4?", options: ["1/2", "1/4", "3/4"], answer: "1/2", grade: 6 },
                    { question: "What is 2/5 + 3/5?", options: ["1", "2/5", "3/5"], answer: "1", grade: 6 },
                    { question: "What is 4/8 simplified?", options: ["1/2", "2/4", "1/4"], answer: "1/2", grade: 6 },
                    { question: "What is 5/6 - 1/6?", options: ["2/3", "4/6", "5/6"], answer: "2/3", grade: 6 },
                    { question: "What is 2/7 + 5/7?", options: ["1", "2/7", "5/7"], answer: "1", grade: 6 },
                    { question: "What is 3/9 simplified?", options: ["1/3", "1/2", "1/4"], answer: "1/3", grade: 6 },
                    { question: "What is 1/2 of 8?", options: ["4", "5", "6"], answer: "4", grade: 6 },
                    { question: "What is 2/5 of 10?", options: ["4", "5", "6"], answer: "4", grade: 6 },
                    { question: "What is 1/4 + 1/4?", options: ["1/2", "1/4", "1"], answer: "1/2", grade: 6 },
                    { question: "What is 3/6 simplified?", options: ["1/2", "1/3", "1/6"], answer: "1/2", grade: 6 },
                    { question: "What is 2/8 simplified?", options: ["1/4", "1/2", "1/8"], answer: "1/4", grade: 6 },
                    { question: "What is 5/10 simplified?", options: ["1/2", "1/5", "1/10"], answer: "1/2", grade: 6 },
                    { question: "What is 3/12 simplified?", options: ["1/4", "1/3", "1/6"], answer: "1/4", grade: 6 },
                    { question: "What is 4/12 simplified?", options: ["1/3", "1/4", "1/6"], answer: "1/3", grade: 6 },
                    { question: "What is 6/12 simplified?", options: ["1/2", "1/3", "1/6"], answer: "1/2", grade: 6 },
                    { question: "What is 8/16 simplified?", options: ["1/2", "1/4", "1/8"], answer: "1/2", grade: 6 },
                    { question: "What is 9/18 simplified?", options: ["1/2", "1/3", "1/9"], answer: "1/2", grade: 6 },
                    { question: "What is 10/20 simplified?", options: ["1/2", "1/4", "1/10"], answer: "1/2", grade: 6 },
                    { question: "What is 12/24 simplified?", options: ["1/2", "1/4", "1/12"], answer: "1/2", grade: 6 },
                    { question: "What is 14/28 simplified?", options: ["1/2", "1/4", "1/14"], answer: "1/2", grade: 6 },
                    { question: "What is 16/32 simplified?", options: ["1/2", "1/4", "1/16"], answer: "1/2", grade: 6 },
                    { question: "What is 18/36 simplified?", options: ["1/2", "1/3", "1/18"], answer: "1/2", grade: 6 },

                    // Grade 7: 24 easy percentages
                    { question: "What is 10% of 50?", options: ["5", "10", "15"], answer: "5", grade: 7 },
                    { question: "What is 20% of 30?", options: ["6", "5", "7"], answer: "6", grade: 7 },
                    { question: "What is 25% of 40?", options: ["10", "15", "20"], answer: "10", grade: 7 },
                    { question: "What is 50% of 60?", options: ["30", "20", "40"], answer: "30", grade: 7 },
                    { question: "What is 5% of 100?", options: ["5", "10", "15"], answer: "5", grade: 7 },
                    { question: "What is 10% of 80?", options: ["8", "10", "12"], answer: "8", grade: 7 },
                    { question: "What is 20% of 25?", options: ["5", "10", "15"], answer: "5", grade: 7 },
                    { question: "What is 25% of 12?", options: ["3", "4", "5"], answer: "3", grade: 7 },
                    { question: "What is 50% of 18?", options: ["9", "8", "10"], answer: "9", grade: 7 },
                    { question: "What is 5% of 60?", options: ["3", "5", "6"], answer: "3", grade: 7 },
                    { question: "What is 10% of 90?", options: ["9", "10", "11"], answer: "9", grade: 7 },
                    { question: "What is 20% of 15?", options: ["3", "4", "5"], answer: "3", grade: 7 },
                    { question: "What is 15% of 40?", options: ["6", "7", "8"], answer: "6", grade: 7 },
                    { question: "What is 30% of 50?", options: ["15", "10", "20"], answer: "15", grade: 7 },
                    { question: "What is 40% of 25?", options: ["10", "8", "12"], answer: "10", grade: 7 },
                    { question: "What is 60% of 30?", options: ["18", "15", "20"], answer: "18", grade: 7 },
                    { question: "What is 70% of 20?", options: ["14", "12", "16"], answer: "14", grade: 7 },
                    { question: "What is 80% of 10?", options: ["8", "7", "9"], answer: "8", grade: 7 },
                    { question: "What is 90% of 60?", options: ["54", "50", "56"], answer: "54", grade: 7 },
                    { question: "What is 12.5% of 32?", options: ["4", "5", "6"], answer: "4", grade: 7 },
                    { question: "What is 33% of 30?", options: ["10", "9", "11"], answer: "10", grade: 7 },
                    { question: "What is 40% of 70?", options: ["28", "30", "25"], answer: "28", grade: 7 },
                    { question: "What is 90% of 110?", options: ["99", "100", "90"], answer: "99", grade: 7 },
                    { question: "What is 15% of 200?", options: ["30", "25", "35"], answer: "30", grade: 7 }
                ],
                method: "easy addition subtraction multiplication division fractions percentages",
                description: "A quiz with easy math questions for each grade: simple addition, subtraction, multiplication, division, fractions, and percentages."
            },
            {
                title: "Hard Math Quiz",
                questions: [
                    // Grade 1: 18 normal-hard addition/subtraction (numbers up to 20)
                    { question: "What is 9 + 8?", options: ["16", "17", "18"], answer: "17", grade: 1 },
                    { question: "What is 15 - 7?", options: ["7", "8", "9"], answer: "8", grade: 1 },
                        { question: "What is 12 + 6?", options: ["17", "18", "19"], answer: "18", grade: 1 },
                        { question: "What is 19 - 9?", options: ["9", "10", "11"], answer: "10", grade: 1 },
                        { question: "What is 8 + 11?", options: ["18", "19", "20"], answer: "19", grade: 1 },
                        { question: "What is 17 - 8?", options: ["8", "9", "10"], answer: "9", grade: 1 },
                        { question: "What is 13 + 7?", options: ["19", "20", "21"], answer: "20", grade: 1 },
                        { question: "What is 20 - 12?", options: ["7", "8", "9"], answer: "8", grade: 1 },
                        { question: "What is 14 + 5?", options: ["18", "19", "20"], answer: "19", grade: 1 },
                        { question: "What is 18 - 6?", options: ["11", "12", "13"], answer: "12", grade: 1 },
                        { question: "What is 11 + 8?", options: ["18", "19", "20"], answer: "19", grade: 1 },
                        { question: "What is 16 - 7?", options: ["8", "9", "10"], answer: "9", grade: 1 },
                        { question: "What is 10 + 9?", options: ["18", "19", "20"], answer: "19", grade: 1 },
                        { question: "What is 19 - 11?", options: ["7", "8", "9"], answer: "8", grade: 1 },
                        { question: "What is 7 + 12?", options: ["18", "19", "20"], answer: "19", grade: 1 },
                        { question: "What is 17 - 5?", options: ["11", "12", "13"], answer: "12", grade: 1 },
                        { question: "What is 8 + 10?", options: ["17", "18", "19"], answer: "18", grade: 1 },
                        { question: "What is 20 - 13?", options: ["6", "7", "8"], answer: "7", grade: 1 },

                        // Grade 2: 18 harder addition/subtraction, intro multiplication
                        { question: "What is 18 + 7?", options: ["24", "25", "26"], answer: "25", grade: 2 },
                        { question: "What is 25 - 9?", options: ["15", "16", "17"], answer: "16", grade: 2 },
                        { question: "What is 8 ร 2?", options: ["14", "15", "16"], answer: "16", grade: 2 },
                        { question: "What is 17 + 6?", options: ["22", "23", "24"], answer: "23", grade: 2 },
                        { question: "What is 21 - 8?", options: ["12", "13", "14"], answer: "13", grade: 2 },
                        { question: "What is 7 ร 3?", options: ["20", "21", "22"], answer: "21", grade: 2 },
                        { question: "What is 14 + 9?", options: ["22", "23", "24"], answer: "23", grade: 2 },
                        { question: "What is 19 - 7?", options: ["11", "12", "13"], answer: "12", grade: 2 },
                        { question: "What is 6 ร 4?", options: ["22", "23", "24"], answer: "24", grade: 2 },
                        { question: "What is 13 + 8?", options: ["20", "21", "22"], answer: "21", grade: 2 },
                        { question: "What is 22 - 5?", options: ["16", "17", "18"], answer: "17", grade: 2 },
                        { question: "What is 5 ร 5?", options: ["20", "25", "30"], answer: "25", grade: 2 },
                        { question: "What is 16 + 7?", options: ["22", "23", "24"], answer: "23", grade: 2 },
                        { question: "What is 24 - 8?", options: ["15", "16", "17"], answer: "16", grade: 2 },
                        { question: "What is 4 ร 6?", options: ["22", "23", "24"], answer: "24", grade: 2 },
                        { question: "What is 15 + 8?", options: ["22", "23", "24"], answer: "23", grade: 2 },
                        { question: "What is 23 - 9?", options: ["13", "14", "15"], answer: "14", grade: 2 },
                        { question: "What is 3 ร 7?", options: ["20", "21", "22"], answer: "21", grade: 2 },
                        // Math quiz
                        // Grade 3: 18 multiplication/division, multi-step
                        { question: "What is 6 ร 7?", options: ["42", "36", "48"], answer: "42", grade: 3 },
                        { question: "What is 56 รท 8?", options: ["6", "7", "8"], answer: "7", grade: 3 },
                        { question: "What is 9 ร 5?", options: ["45", "40", "50"], answer: "45", grade: 3 },
                        { question: "What is 63 รท 9?", options: ["6", "7", "8"], answer: "7", grade: 3 },
                        { question: "What is 8 ร 8?", options: ["64", "56", "72"], answer: "64", grade: 3 },
                        { question: "What is 72 รท 6?", options: ["12", "11", "13"], answer: "12", grade: 3 },
                        { question: "What is 7 ร 9?", options: ["63", "56", "72"], answer: "63", grade: 3 },
                        { question: "What is 81 รท 9?", options: ["8", "9", "10"], answer: "9", grade: 3 },
                        { question: "What is 12 ร 6?", options: ["72", "66", "76"], answer: "72", grade: 3 },
                        { question: "What is 90 รท 10?", options: ["8", "9", "10"], answer: "9", grade: 3 },
                        { question: "What is 11 ร 7?", options: ["77", "66", "88"], answer: "77", grade: 3 },
                        { question: "What is 84 รท 7?", options: ["11", "12", "13"], answer: "12", grade: 3 },
                        { question: "What is 13 ร 5?", options: ["65", "60", "70"], answer: "65", grade: 3 },
                        { question: "What is 96 รท 8?", options: ["11", "12", "13"], answer: "12", grade: 3 },
                        { question: "What is 14 ร 4?", options: ["56", "54", "58"], answer: "56", grade: 3 },
                        { question: "What is 100 รท 4?", options: ["24", "25", "26"], answer: "25", grade: 3 },
                        { question: "What is 15 ร 3?", options: ["45", "40", "50"], answer: "45", grade: 3 },
                        { question: "What is 108 รท 12?", options: ["8", "9", "10"], answer: "9", grade: 3 },

                        // Grade 4: 18 multi-digit multiplication/division, intro to decimals
                        { question: "What is 23 ร 2?", options: ["44", "46", "48"], answer: "46", grade: 4 },
                        { question: "What is 144 รท 12?", options: ["11", "12", "13"], answer: "12", grade: 4 },
                        { question: "What is 17 ร 3?", options: ["51", "50", "53"], answer: "51", grade: 4 },
                        { question: "What is 156 รท 13?", options: ["11", "12", "13"], answer: "12", grade: 4 },
                        { question: "What is 18 ร 4?", options: ["72", "74", "76"], answer: "72", grade: 4 },
                        { question: "What is 180 รท 9?", options: ["19", "20", "21"], answer: "20", grade: 4 },
                        { question: "What is 21 ร 5?", options: ["105", "110", "115"], answer: "105", grade: 4 },
                        { question: "What is 225 รท 15?", options: ["14", "15", "16"], answer: "15", grade: 4 },
                        { question: "What is 19 ร 6?", options: ["114", "115", "116"], answer: "114", grade: 4 },
                        { question: "What is 132 รท 12?", options: ["10", "11", "12"], answer: "11", grade: 4 },
                        { question: "What is 24 ร 3?", options: ["72", "73", "74"], answer: "72", grade: 4 },
                        { question: "What is 168 รท 8?", options: ["20", "21", "22"], answer: "21", grade: 4 },
                        { question: "What is 2.5 ร 4?", options: ["10", "9", "8"], answer: "10", grade: 4 },
                        { question: "What is 12.6 รท 2?", options: ["6.3", "6.5", "6.1"], answer: "6.3", grade: 4 },
                        { question: "What is 3.4 ร 3?", options: ["10.2", "9.2", "11.2"], answer: "10.2", grade: 4 },
                        { question: "What is 15.6 รท 4?", options: ["3.9", "4.1", "4.2"], answer: "3.9", grade: 4 },
                        { question: "What is 7.5 ร 2?", options: ["15", "14", "16"], answer: "15", grade: 4 },
                        { question: "What is 18.4 รท 2?", options: ["9.2", "8.2", "10.2"], answer: "9.2", grade: 4 },

                        // Grade 5: 18 decimals, multi-step, intro to fractions
                        { question: "What is 12.5 + 7.8?", options: ["20.3", "19.3", "21.3"], answer: "20.3", grade: 5 },
                        { question: "What is 25.6 - 13.2?", options: ["12.4", "13.4", "11.4"], answer: "12.4", grade: 5 },
                        { question: "What is 3.2 ร 4?", options: ["12.8", "13.8", "14.8"], answer: "12.8", grade: 5 },
                        { question: "What is 24.6 รท 2?", options: ["12.3", "13.3", "11.3"], answer: "12.3", grade: 5 },
                        { question: "What is 7.5 + 8.6?", options: ["16.1", "15.1", "17.1"], answer: "16.1", grade: 5 },
                        { question: "What is 19.8 - 6.7?", options: ["13.1", "12.1", "14.1"], answer: "13.1", grade: 5 },
                        { question: "What is 2.5 ร 6?", options: ["15", "14", "16"], answer: "15", grade: 5 },
                        { question: "What is 18.9 รท 3?", options: ["6.3", "5.3", "7.3"], answer: "6.3", grade: 5 },
                        { question: "What is 1/2 + 1/4?", options: ["3/4", "2/4", "1/2"], answer: "3/4", grade: 5 },
                        { question: "What is 3/5 - 1/5?", options: ["2/5", "1/5", "3/5"], answer: "2/5", grade: 5 },
                        { question: "What is 2/3 ร 3?", options: ["2", "1", "3"], answer: "2", grade: 5 },
                        { question: "What is 3/4 รท 3?", options: ["1/4", "1/3", "1/2"], answer: "1/4", grade: 5 },
                        { question: "What is 2/7 ร 7?", options: ["2", "1", "7"], answer: "2", grade: 5 },
                        { question: "What is 1/2 of 10?", options: ["5", "4", "6"], answer: "5", grade: 5 },
                        { question: "What is 2/5 of 20?", options: ["8", "6", "10"], answer: "8", grade: 5 },
                        { question: "What is 4/8 simplified?", options: ["1/2", "2/4", "1/4"], answer: "1/2", grade: 5 },
                        { question: "What is 5/6 - 1/6?", options: ["2/3", "4/6", "5/6"], answer: "2/3", grade: 5 },
                        { question: "What is 3/9 simplified?", options: ["1/3", "1/2", "1/4"], answer: "1/3", grade: 5 },

                        // Grade 6: 18 fractions, ratios, multi-step decimals
                        { question: "What is 2/3 + 1/6?", options: ["5/6", "2/6", "1/2"], answer: "5/6", grade: 6 },
                        { question: "What is 7/8 - 3/8?", options: ["4/8", "1/2", "5/8"], answer: "1/2", grade: 6 },
                        { question: "What is 3/4 ร 2?", options: ["1.5", "1.25", "2"], answer: "1.5", grade: 6 },
                        { question: "What is 5/6 รท 2?", options: ["5/12", "5/6", "1/3"], answer: "5/12", grade: 6 },
                        { question: "What is 2:5 as a fraction?", options: ["2/5", "5/2", "1/2"], answer: "2/5", grade: 6 },
                        { question: "What is 3/7 + 2/7?", options: ["5/7", "1/7", "3/9"], answer: "5/7", grade: 6 },
                        { question: "What is 6/9 simplified?", options: ["2/3", "1/3", "1/2"], answer: "2/3", grade: 6 },
                        { question: "What is 4/12 simplified?", options: ["1/3", "1/4", "1/6"], answer: "1/3", grade: 6 },
                        { question: "What is 7/14 simplified?", options: ["1/2", "1/4", "1/7"], answer: "1/2", grade: 6 },
                        { question: "What is 8/16 simplified?", options: ["1/2", "1/4", "1/8"], answer: "1/2", grade: 6 },
                        { question: "What is 9/18 simplified?", options: ["1/2", "1/3", "1/9"], answer: "1/2", grade: 6 },
                        { question: "What is 10/20 simplified?", options: ["1/2", "1/4", "1/10"], answer: "1/2", grade: 6 },
                        { question: "What is 12/24 simplified?", options: ["1/2", "1/4", "1/12"], answer: "1/2", grade: 6 },
                        { question: "What is 14/28 simplified?", options: ["1/2", "1/4", "1/14"], answer: "1/2", grade: 6 },
                        { question: "What is 16/32 simplified?", options: ["1/2", "1/4", "1/16"], answer: "1/2", grade: 6 },
                        { question: "What is 18/36 simplified?", options: ["1/2", "1/3", "1/18"], answer: "1/2", grade: 6 },
                        { question: "What is 2.5 + 3.75?", options: ["6.25", "5.25", "7.25"], answer: "6.25", grade: 6 },
                        { question: "What is 7.2 - 4.8?", options: ["2.4", "3.4", "1.4"], answer: "2.4", grade: 6 },

                        // Grade 7: 18 percentages, multi-step, harder fractions/ratios
                        { question: "What is 35% of 120?", options: ["42", "36", "40"], answer: "42", grade: 7 },
                        { question: "What is 60% of 250?", options: ["150", "140", "160"], answer: "150", grade: 7 },
                        { question: "What is 15% of 180?", options: ["27", "28", "29"], answer: "27", grade: 7 },
                        { question: "What is 75% of 88?", options: ["66", "65", "67"], answer: "66", grade: 7 },
                        { question: "What is 12.5% of 96?", options: ["12", "10", "8"], answer: "12", grade: 7 },
                        { question: "What is 33% of 150?", options: ["49.5", "50", "45"], answer: "49.5", grade: 7 },
                        { question: "What is 40% of 225?", options: ["90", "80", "100"], answer: "90", grade: 7 },
                        { question: "What is 90% of 210?", options: ["189", "190", "191"], answer: "189", grade: 7 },
                        { question: "What is 2/5 of 75?", options: ["30", "25", "35"], answer: "30", grade: 7 },
                        { question: "What is 3/8 of 64?", options: ["24", "18", "20"], answer: "24", grade: 7 },
                        { question: "What is 5/6 of 60?", options: ["50", "55", "45"], answer: "50", grade: 7 },
                        { question: "What is 7/10 of 90?", options: ["63", "65", "67"], answer: "63", grade: 7 },
                        { question: "What is 4:5 as a fraction?", options: ["4/5", "5/4", "1/4"], answer: "4/5", grade: 7 },
                        { question: "What is 3:8 as a fraction?", options: ["3/8", "8/3", "1/3"], answer: "3/8", grade: 7 },
                        { question: "What is 2/3 of 81?", options: ["54", "53", "52"], answer: "54", grade: 7 },
                        { question: "What is 5/9 of 81?", options: ["45", "40", "50"], answer: "45", grade: 7 },
                        { question: "What is 7/8 of 64?", options: ["56", "54", "58"], answer: "56", grade: 7 },
                        { question: "What is 9/10 of 120?", options: ["108", "110", "112"], answer: "108", grade: 7 }
                    ],
                    method: "normal-hard addition subtraction multiplication division decimals fractions ratios percentages",
                    description: "A challenging quiz with 18 questions per grade: harder addition, subtraction, multiplication, division, decimals, fractions, ratios, and percentages."
                }
            
            ];

                let quizCreatedHomeContainer = document.getElementById("quiz-created-home");
                let quizCreatedCreateContainer = document.getElementById("quiz-created");
                try {
                    quizCreated = JSON.parse(localStorage.getItem("quizCreated") || "[]");
                } catch {}
        
                // Define startQuiz globally if not already defined
                if (typeof window.startQuiz !== "function") {
                    window.startQuiz = function(quiz) {
                        // Use the same logic as in your main startQuiz function
                        currentQuiz = quiz;
                        currentQuestions = quiz.questions.filter(q => {
                            let profile = localStorage.getItem("schoolProfile");
                            if (profile) {
                                try {
                                    let grade = parseInt(JSON.parse(profile).grade);
                                    return q.grade == grade;
                                } catch {}
                            }
                            return true;
                        });
                        currentQuestionIndex = 0;
                        currentScore = 0;
                        quizStartTime = Date.now();
                        document.querySelector(".home-screen").style.display = "none";
                        document.querySelector(".quiz-screen").style.display = "block";
                        renderQuizQuestion();
                        startQuizTimer();
                    };
                }
        
                // Attach event listeners to "Start Quiz" buttons for created quizzes (Home)
                if (quizCreatedHomeContainer) {
                    quizCreatedHomeContainer.addEventListener("click", function(e) {
                        if (e.target && e.target.classList.contains("start-quiz-btn")) {
                            const quizDivs = Array.from(quizCreatedHomeContainer.querySelectorAll(".quiz-item"));
                            const idx = quizDivs.indexOf(e.target.closest(".quiz-item"));
                            if (idx !== -1 && quizCreated[idx]) {
                                window.startQuiz(quizCreated[idx]);
                            }
                        }
                    });
                }
                // Attach event listeners to "Start Quiz" buttons for created quizzes (Create)
                if (quizCreatedCreateContainer) {
                    quizCreatedCreateContainer.addEventListener("click", function(e) {
                        if (e.target && e.target.classList.contains("start-quiz-btn")) {
                            const quizDivs = Array.from(quizCreatedCreateContainer.querySelectorAll(".quiz-item"));
                            const idx = quizDivs.indexOf(e.target.closest(".quiz-item"));
                            if (idx !== -1 && quizCreated[idx]) {
                                window.startQuiz(quizCreated[idx]);
                            }
                        }
                    });
                }





            // Sound effects
            // End quiz and show result
            function endQuiz() {
                // Save quiz attempt to history before UI update
                if (currentQuiz && typeof currentScore === "number") {
                    let elapsed = Math.floor((Date.now() - quizStartTime) / 1000);
                    let min = Math.floor(elapsed / 60);
                    let sec = elapsed % 60;
                    let timeStr = `${min}:${sec.toString().padStart(2, "0")}`;
                    // Save to quizHistory in localStorage
                    let history = [];
                    try {
                        history = JSON.parse(localStorage.getItem("quizHistory") || "[]");
                    } catch {}
                    history.push({
                        title: currentQuiz.title,
                        description: currentQuiz.description,
                        score: currentScore,
                        date: new Date().toLocaleString(),
                        time: timeStr
                    });
                    localStorage.setItem("quizHistory", JSON.stringify(history));
                    // Update history list UI if present
                    if (document.getElementById("historyList")) {
                        // If search box exists, filter by its value
                        const searchBox = document.getElementById("searchHistory");
                        renderHistoryList(searchBox ? searchBox.value : "");
                    }
                }

                clearInterval(quizTimerInterval);
                const container = document.getElementById("quiz-questions");
                container.innerHTML = "";

                let message = "";
                let actionBtn = "";
                if (currentScore <= 18) {
                    message = "That's OK! You can try again.";
                    actionBtn = `<button id="quiz-try-again-btn" style="margin-top:18px;">Try Again</button>`;
                } else if (currentScore <= 31) {
                    message = "Keep trying your best!";
                } else if (currentScore <= 61) {
                    message = "Good Job!";
                } else if (currentScore <= 100) {
                    message = "Great Job!";
                }

                // Always show Go Home button
                actionBtn += `<button id="quiz-home-btn" style="margin-top:18px;">Go Home</button>`;

                container.innerHTML = `
                    <div style="text-align:center;padding:40px 0;">
                        <div style="font-size:2.2rem;font-weight:700;color:#7817d3;margin-bottom:12px;">Quiz Complete!</div>
                        <div style="font-size:1.5rem;margin-bottom:18px;">Your Score: <b>${currentScore}</b></div>
                        <div style="font-size:1.3rem;margin-bottom:18px;">${message}</div>
                        ${actionBtn}
                    </div>
                `;

                // If this quiz is in completed quizzes, show "Start Quiz" button to retry
                if (
                    quizCompleted &&
                    quizCompleted.some(q => q.title === currentQuiz.title)
                ) {
                    const retryBtn = document.createElement("button");
                    retryBtn.textContent = t("Start Quiz");
                    retryBtn.className = "start-quiz-btn";
                    retryBtn.style.marginTop = "18px";
                    retryBtn.onclick = () => {
                        currentQuestionIndex = 0;
                        currentScore = 0;
                        quizStartTime = Date.now();
                        renderQuizQuestion();
                        startQuizTimer();
                    };
                    container.appendChild(retryBtn);
                }

                // If score > 19, add to completed quizzes and update UI
                if (currentScore > 19 && currentQuiz) {
                    // Avoid duplicates by title
                    if (!quizCompleted.some(q => q.title === currentQuiz.title)) {
                        const completedQuiz = {
                            title: currentQuiz.title,
                            description: currentQuiz.description,
                            score: currentScore,
                            date: new Date().toLocaleString()
                        };
                        quizCompleted.push(completedQuiz);
                        renderQuizzes(quizCompletedContainer, quizCompleted);

                        // Save to profile and localStorage
                        let profile = localStorage.getItem("schoolProfile");
                        if (profile) {
                            try {
                                let profileObj = JSON.parse(profile);
                                if (!Array.isArray(profileObj.completedQuizzes)) {
                                    profileObj.completedQuizzes = [];
                                }
                                // Avoid duplicates in profile as well
                                if (!profileObj.completedQuizzes.some(q => q.title === completedQuiz.title)) {
                                    profileObj.completedQuizzes.push(completedQuiz);
                                    localStorage.setItem("schoolProfile", JSON.stringify(profileObj));
                                }
                            } catch {}
                        }

                        // Also persist quizCompleted array to localStorage for future sessions
                        localStorage.setItem("quizCompleted", JSON.stringify(quizCompleted));
                    }
                }

                // Button listeners
                const tryAgainBtn = document.getElementById("quiz-try-again-btn");
                if (tryAgainBtn) {
                    tryAgainBtn.onclick = () => {
                        currentQuestionIndex = 0;
                        currentScore = 0;
                        quizStartTime = Date.now();
                        renderQuizQuestion();
                        startQuizTimer();
                    };
                }
                const homeBtn = document.getElementById("quiz-home-btn");
                if (homeBtn) {
                    homeBtn.onclick = () => {
                        document.querySelector(".quiz-screen").style.display = "none";
                        document.querySelector(".home-screen").style.display = "block";
                    };
                }
            }
            const correctSound = new Audio("correct.mp3");
            const wrongSound = new Audio("wrong.mp3");

            let currentQuiz = null;
            let currentQuestions = [];
            let currentQuestionIndex = 0;
            let currentScore = 0;
            let quizStartTime = 0;
            let quizTimerInterval = null;

            // Warn before reload/close if quiz in progress
            window.addEventListener("beforeunload", function (e) {
                // Only show warning if quiz is in progress
                if (
                    document.querySelector(".quiz-screen") &&
                    document.querySelector(".quiz-screen").style.display === "block"
                ) {
                    e.preventDefault();
                    e.returnValue = "Reloading this site, any unsaved changes will be lost.";
                    return "Reloading this site, any unsaved changes will be lost.";
                }
            });

            // Show quiz screen and start quiz
            function startQuiz(quiz) {
                currentQuiz = quiz;
                currentQuestions = quiz.questions.filter(q => {
                    // Filter by grade if profile exists
                    let profile = localStorage.getItem("schoolProfile");
                    if (profile) {
                        try {
                            let grade = parseInt(JSON.parse(profile).grade);
                            return q.grade == grade;
                        } catch {}
                    }
                    return true;
                });
                currentQuestionIndex = 0;
                currentScore = 0;
                quizStartTime = Date.now();
                document.querySelector(".home-screen").style.display = "none";
                document.querySelector(".quiz-screen").style.display = "block";
                renderQuizQuestion();
                startQuizTimer();
            }

            // Render current question
            // Render current question
            function renderQuizQuestion() {
                const container = document.getElementById("quiz-questions");
                container.innerHTML = "";
                // Quiz header with score, timer, and answered count at right
                const quizHeader = document.createElement("div");
                quizHeader.style.display = "flex";
                quizHeader.style.justifyContent = "space-between";
                quizHeader.style.alignItems = "center";
                quizHeader.style.marginBottom = "18px";
                quizHeader.innerHTML = `
                    <div class="quiz-stats" style="font-size:1.2rem;font-weight:600;">
                        ${t("Question")} ${currentQuestionIndex + 1} ${t("of")} ${currentQuestions.length}
                    </div>
                    <div class="quiz-stats" style="display:flex;align-items:center;gap:24px;">
                        <div class="quiz-stats" id="quiz-answered" style="font-size:1.1rem;background:#eae6fa;color:#7817d3;padding:6px 18px;border-radius:18px;box-shadow:0 2px 8px rgba(120,23,211,0.07);font-weight:600;display:flex;align-items:center;gap:6px;">
                            <span class="material-symbols-outlined" style="font-size:1.3rem;">done_all</span>
                            <span id="answered-value">${currentQuestionIndex}/${currentQuestions.length}</span>
                        </div>
                        <div class="quiz-stats" id="quiz-score" style="font-size:1.1rem;background:#eae6fa;color:#7817d3;padding:6px 18px;border-radius:18px;box-shadow:0 2px 8px rgba(120,23,211,0.07);font-weight:600;display:flex;align-items:center;gap:6px;">
                            <span class="material-symbols-outlined" style="font-size:1.3rem;">star</span>
                            <span id="score-value">${currentScore}</span>
                        </div>
                        <div class="quiz-stats" id="quiz-timer" style="font-size:1.1rem;background:#eae6fa;color:#7817d3;padding:6px 18px;border-radius:18px;box-shadow:0 2px 8px rgba(120,23,211,0.07);font-weight:600;display:flex;align-items:center;gap:6px;">
                            <span class="material-symbols-outlined" style="font-size:1.3rem;">schedule</span>
                            <span id="timer-value">0:00</span>
                        </div>
                    </div>
                `;
                container.appendChild(quizHeader);
            
                if (currentQuestionIndex >= currentQuestions.length) {
                    endQuiz();
                    return;
                }
                const q = currentQuestions[currentQuestionIndex];
                // Always shuffle options before rendering
                const shuffledOptions = shuffle(q.options);
            
                // Translate "What", "is", "of", and "Question" in the question text
                function translateQuestionText(text) {
                    // Replace only whole words, case-sensitive
                    return text
                        .replace(/\bWhat\b/g, t("What"))
                        .replace(/\bis\b/g, t("is"))
                        .replace(/\bof\b/g, t("of"))
                        .replace(/\bQuestion\b/g, t("Question"));
                }
            
                const qDiv = document.createElement("div");
                qDiv.className = "quiz-question";
                qDiv.style.background = "#fff";
                qDiv.style.borderRadius = "14px";
                qDiv.style.boxShadow = "0 2px 16px rgba(120,23,211,0.08)";
                qDiv.style.padding = "28px 18px 22px 18px";
                qDiv.style.margin = "0 auto";
                qDiv.style.maxWidth = "520px";
                qDiv.style.position = "relative";
                qDiv.style.transition = "box-shadow 0.3s";
                qDiv.innerHTML = `
                    <div style="font-size:1.25rem;margin-bottom:18px;font-weight:500;letter-spacing:0.01em;">
                        <span class="material-symbols-outlined" style="color:#7817d3;vertical-align:middle;font-size:1.5rem;margin-right:6px;">help</span>
                        ${translateQuestionText(q.question)}
                    </div>
                    <div class="quiz-options" style="display:grid;grid-template-columns:1fr 1fr;gap:16px 18px;margin-bottom:18px;"></div>
                    <div id="quiz-feedback" style="margin-top:8px;min-height:38px;text-align:center;"></div>
                `;
                // Render options
                const optionsDiv = qDiv.querySelector(".quiz-options");
                shuffledOptions.forEach(opt => {
                    const btn = document.createElement("button");
                    btn.textContent = opt;
                    btn.style.transition = "background 0.3s, color 0.3s, box-shadow 0.3s, transform 0.2s";
                    btn.style.fontSize = "1.1rem";
                    btn.style.padding = "14px 0";
                    btn.style.background = "#f7f3ff";
                    btn.style.color = "#7817d3";
                    btn.style.border = "2px solid #eae6fa";
                    btn.style.borderRadius = "10px";
                    btn.style.fontWeight = "600";
                    btn.style.boxShadow = "0 1px 6px rgba(120,23,211,0.06)";
                    btn.style.cursor = "pointer";
                    btn.onmouseenter = () => btn.style.transform = "scale(1.04)";
                    btn.onmouseleave = () => btn.style.transform = "scale(1)";
                    btn.onclick = () => handleQuizAnswer(btn, opt, q.answer);
                    optionsDiv.appendChild(btn);
                });
            
                // Append the question div to the container so options are visible
                container.appendChild(qDiv);
            
                // Show timer, score, and answered count
                updateQuizTimer();
                updateQuizScore();
                updateQuizAnswered();
            }
            // Update answered count
            function updateQuizAnswered() {
                const answeredValue = document.getElementById("answered-value");
                if (answeredValue) answeredValue.textContent = `${currentQuestionIndex}/${currentQuestions.length}`;
            }

            // Handle answer selection
            function handleQuizAnswer(btn, selected, correct) {
                // Prevent double answer
                const options = btn.parentNode.querySelectorAll("button");
                options.forEach(b => b.disabled = true);

                let isCorrect = selected === correct;
                let scoreChange = isCorrect
                    ? Math.floor(Math.random() * 15) + 13 // +13 to +27
                    : -1 * (Math.floor(Math.random() * 9) + 3); // -3 to -11

                currentScore += scoreChange;
                updateQuizScore();

                // Play sound
                if (isCorrect) {
                    correctSound.currentTime = 0;
                    correctSound.play();
                } else {
                    wrongSound.currentTime = 0;
                    wrongSound.play();
                }

                // Show feedback with animation
                const feedback = document.getElementById("quiz-feedback");
                feedback.innerHTML = isCorrect
                    ? `<span style="color:#2ecc40;font-size:2rem;vertical-align:middle;display:inline-flex;align-items:center;gap:8px;animation:bounceIn 0.7s;">
                        <span class="material-symbols-outlined" style="font-size:2.2rem;">check_circle</span> Correct! <span style="font-size:1.2rem;">+${scoreChange}</span>
                       </span>`
                    : `<span style="color:#e74c3c;font-size:2rem;vertical-align:middle;display:inline-flex;align-items:center;gap:8px;animation:shake 0.7s;">
                        <span class="material-symbols-outlined" style="font-size:2.2rem;">cancel</span> Wrong! <span style="font-size:1.2rem;">${scoreChange}</span>
                       </span>
                       <br><span style="color:#7817d3;font-size:1.1rem;">Correct answer: <b>${correct}</b></span>`;

                // Animate selected button
                btn.style.background = isCorrect ? "#2ecc40" : "#e74c3c";
                btn.style.color = "#fff";
                btn.style.borderColor = isCorrect ? "#2ecc40" : "#e74c3c";
                btn.style.boxShadow = isCorrect
                    ? "0 0 16px 2px #2ecc40"
                    : "0 0 16px 2px #e74c3c";
                btn.style.transform = "scale(1.07)";

                // Highlight correct answer if wrong
                if (!isCorrect) {
                    options.forEach(b => {
                        if (b.textContent === correct) {
                            b.style.background = "#2ecc40";
                            b.style.color = "#fff";
                            b.style.borderColor = "#2ecc40";
                            b.style.boxShadow = "0 0 16px 2px #2ecc40";
                        }
                    });
                }

                // Next question after 5 seconds
                setTimeout(() => {
                    currentQuestionIndex++;
                    renderQuizQuestion();
                }, 5000);
            }

            // Timer logic
            function startQuizTimer() {
                function update() {
                    let elapsed = Math.floor((Date.now() - quizStartTime) / 1000);
                    let min = Math.floor(elapsed / 60);
                    let sec = elapsed % 60;
                    const timerValue = document.getElementById("timer-value");
                    if (timerValue) {
                        timerValue.textContent = `${min}:${sec.toString().padStart(2, "0")}`;
                    }
                }
                if (quizTimerInterval) clearInterval(quizTimerInterval);
                quizTimerInterval = setInterval(update, 500);
                update();
            }
            function updateQuizTimer() {
                if (!quizTimerInterval) startQuizTimer();
                // Also update immediately
                let elapsed = Math.floor((Date.now() - quizStartTime) / 1000);
                let min = Math.floor(elapsed / 60);
                let sec = elapsed % 60;
                const timerValue = document.getElementById("timer-value");
                if (timerValue) {
                    timerValue.textContent = `${min}:${sec.toString().padStart(2, "0")}`;
                }
            }
            function updateQuizScore() {
                const scoreValue = document.getElementById("score-value");
                if (scoreValue) scoreValue.textContent = currentScore;
            }


        const quizCreated = [];
        // Load completed quizzes from localStorage if available
        let quizCompleted = [];
        try {
            const savedCompleted = localStorage.getItem("quizCompleted");
            if (savedCompleted) {
                quizCompleted = JSON.parse(savedCompleted);
            }
        } catch {}
        const quizTempContainer = document.getElementById("quiz-temp");
        const quizCreatedContainer = document.getElementById("quiz-created");
        const quizCompletedContainer = document.getElementById("quiz-completed");
        // Function to render quizzes
        function renderQuizzes(container, quizzes) {
            container.innerHTML = ""; // Clear existing content
            if (quizzes.length === 0) {
                container.innerHTML = "<p>No quizzes available.</p>";
                return;
            }
            quizzes.forEach(quiz => {
                const quizDiv = document.createElement("div");
                quizDiv.className = "quiz-item";
                quizDiv.innerHTML = `
                    <h4>${quiz.title}</h4>
                    <p>${quiz.description}</p>
                    <button class="start-quiz-btn">Start Quiz</button>
                `;
                container.appendChild(quizDiv);
            });
        }

        // Render all quizzes
        renderQuizzes(quizTempContainer, quizTemp);
        renderQuizzes(quizCreatedContainer, quizCreated);
        renderQuizzes(quizCompletedContainer, quizCompleted);

        // Attach event listeners to "Start Quiz" buttons for template quizzes
        quizTempContainer.addEventListener("click", function(e) {
            if (e.target && e.target.classList.contains("start-quiz-btn")) {
                // Find the quiz index
                const quizDivs = Array.from(quizTempContainer.querySelectorAll(".quiz-item"));
                const idx = quizDivs.indexOf(e.target.closest(".quiz-item"));
                if (idx !== -1) {
                    startQuiz(quizTemp[idx]);
                }
            }
        });

        // Attach event listeners to "Start Quiz" buttons for completed quizzes
        quizCompletedContainer.addEventListener("click", function(e) {
            if (e.target && e.target.classList.contains("start-quiz-btn")) {
                // Find the quiz index
                const quizDivs = Array.from(quizCompletedContainer.querySelectorAll(".quiz-item"));
                const idx = quizDivs.indexOf(e.target.closest(".quiz-item"));
                if (idx !== -1) {
                    // Find the original quiz object by title from quizTemp
                    const completedQuizTitle = quizCompleted[idx].title;
                    let quizToStart = quizTemp.find(q => q.title === completedQuizTitle);
                    if (!quizToStart) {
                        // If not found in quizTemp, fallback to quizCreated or use summary (will not work if no questions)
                        quizToStart = quizCreated.find(q => q.title === completedQuizTitle) || quizCompleted[idx];
                    }
                    if (quizToStart && quizToStart.questions) {
                        startQuiz(quizToStart);
                    } else {
                        showToast && showToast("Quiz data not found.");
                    }
                }
            }
        });

        // You can add similar listeners for created quizzes if needed
    });


    // Removed duplicate start/home screen logic to prevent conflicting display settings.





    // Admin Settings Modal logic with password from profile, using modal UI

    const adminSettingsBtn = document.getElementById("adminSettings");
    const adminSettingsModal = document.getElementById("adminSettingsModal");
    const closeModalBtn = document.getElementById("closeModal");

    // Create password modal if not exists
    let passwordModal = document.getElementById("adminPasswordModal");
    if (!passwordModal) {
        passwordModal = document.createElement("div");
        passwordModal.id = "adminPasswordModal";
        passwordModal.style.display = "none";
        passwordModal.style.position = "fixed";
        passwordModal.style.top = "0";
        passwordModal.style.left = "0";
        passwordModal.style.width = "100vw";
        passwordModal.style.height = "100vh";
        passwordModal.style.background = "rgba(0,0,0,0.4)";
        passwordModal.style.zIndex = "10001";
        passwordModal.innerHTML = `
            <div class="modal-content" style="background:#5a14a0;max-width:340px;margin:120px auto;padding:32px 24px;border-radius:12px;box-shadow:0 4px 24px rgba(0,0,0,0.18);position:relative;">
                <h3 style="margin-top:0;">Enter Admin Password</h3>
                <input type="password" id="adminPasswordInput" placeholder="Password" style="width:100%;padding:10px;margin:12px 0 18px 0;border-radius:5px;border:1px solid #ccc;">
                <div style="display:flex;gap:12px;justify-content:flex-end;">
                    <button id="adminPasswordCancel" style="padding:8px 18px;border-radius:6px;border:none;background:#ccc;color:#222;">Cancel</button>
                    <button id="adminPasswordSubmit" style="padding:8px 18px;border-radius:6px;border:none;background:#7817d3;color:#fff;">OK</button>
                </div>
            </div>
        `;
        document.body.appendChild(passwordModal);
    }

    function showPasswordModal(onSubmit) {
        passwordModal.style.display = "block";
        const input = document.getElementById("adminPasswordInput");
        input.value = "";
        input.focus();
        function cleanup() {
            passwordModal.style.display = "none";
            submitBtn.removeEventListener("click", submitHandler);
            cancelBtn.removeEventListener("click", cancelHandler);
            input.removeEventListener("keydown", enterHandler);
        }
        function submitHandler() {
            onSubmit(input.value);
            cleanup();
        }
        function cancelHandler() {
            cleanup();
        }
        function enterHandler(e) {
            if (e.key === "Enter") {
                submitHandler();
            }
        }
        const submitBtn = document.getElementById("adminPasswordSubmit");
        const cancelBtn = document.getElementById("adminPasswordCancel");
        submitBtn.addEventListener("click", submitHandler);
        cancelBtn.addEventListener("click", cancelHandler);
        input.addEventListener("keydown", enterHandler);
        // Hide modal if clicking outside content
        passwordModal.onclick = function(e) {
            if (e.target === passwordModal) cleanup();
        };
    }

    // Hide admin settings modal initially
    adminSettingsModal.style.display = "none";

    adminSettingsBtn.addEventListener("click", function(e) {
        e.stopPropagation();
        // Always require password modal and check against profile password
        showPasswordModal(function(input) {
            let profile = localStorage.getItem("schoolProfile");
            let profilePassword = "${profilePassword}";
            if (profile) {
                try {
                    profilePassword = JSON.parse(profile).password || "";
                } catch {}
            }
            if (input === profilePassword && profilePassword !== "") {
                adminSettingsModal.style.display = "block";
            } else {
                showToast("Incorrect password.");
            }
        });
    });

    closeModalBtn.addEventListener("click", function() {
        adminSettingsModal.style.display = "none";
    });

    // Hide modal if clicking outside modal content
    adminSettingsModal.addEventListener("click", function(e) {
        if (e.target === adminSettingsModal) {
            adminSettingsModal.style.display = "none";
        }
    });

        const profileBtn = document.querySelector(".profile-btn");
        const profileMenu = document.querySelector(".profile-menu");

        // Ensure profile-menu is directly after profileBtn in the DOM for correct positioning
        if (profileBtn && profileMenu && profileBtn.nextElementSibling !== profileMenu) {
            profileBtn.parentNode.insertBefore(profileMenu, profileBtn.nextSibling);
        }

        // Toggle profile menu on button click
        profileBtn.addEventListener("click", function (e) {
            e.stopPropagation();
            if (profileMenu.style.display === "block") {
                profileMenu.style.display = "none";
            } else {
                profileMenu.style.display = "block";
                // Position the menu just below the profile button
                const rect = profileBtn.getBoundingClientRect();
                profileMenu.style.position = "absolute";
                profileMenu.style.top = (profileBtn.offsetTop + profileBtn.offsetHeight) + "px";
                profileMenu.style.right = "0";
                profileMenu.style.left = "auto";
            }
        });

        // Hide profile menu when clicking outside
        document.addEventListener("click", function (e) {
            if (!profileMenu.contains(e.target) && !profileBtn.contains(e.target)) {
                profileMenu.style.display = "none";
            }
        });

        // Optional: Hide menu on ESC key
        document.addEventListener("keydown", function (e) {
            if (e.key === "Escape") {
                profileMenu.style.display = "none";
            }
        });



        const darkModeToggle = document.getElementById("dark-mode-toggle");

        // Apply theme from profile or localStorage
        function applyTheme(theme) {
            if (theme === "dark") {
                document.body.classList.add("dark-mode");
            } else {
                document.body.classList.remove("dark-mode");
            }
        }

        // On page load, set theme from profile or fallback to light
        window.addEventListener("DOMContentLoaded", function() {
            let profile = localStorage.getItem("schoolProfile");
            let theme = "light";
            if (profile) {
                try {
                    theme = JSON.parse(profile).theme || "light";
                } catch {}
            }
            applyTheme(theme);
        });

        // Toggle dark mode on icon click
        darkModeToggle.addEventListener("click", function() {
            let profile = localStorage.getItem("schoolProfile");
            let theme = "light";
            if (profile) {
                try {
                    let profileObj = JSON.parse(profile);
                    theme = profileObj.theme === "dark" ? "light" : "dark";
                    profileObj.theme = theme;
                    localStorage.setItem("schoolProfile", JSON.stringify(profileObj));
                } catch {}
            } else {
                // If no profile, just toggle class
                theme = document.body.classList.contains("dark-mode") ? "light" : "dark";
            }
            applyTheme(theme);
        });

        function showToast(message, duration = 2500) {
            // Remove existing toast if present
            const existing = document.getElementById("toast-message");
            if (existing) existing.remove();

            // Create toast element
            const toast = document.createElement("div");
            toast.id = "toast-message";
            toast.textContent = message;
            toast.style.position = "fixed";
            toast.style.bottom = "32px";
            toast.style.left = "50%";
            toast.style.transform = "translateX(-50%)";
            toast.style.background = "#333";
            toast.style.color = "#fff";
            toast.style.padding = "14px 32px";
            toast.style.borderRadius = "24px";
            toast.style.boxShadow = "0 2px 16px rgba(0,0,0,0.18)";
            toast.style.fontSize = "1rem";
            toast.style.zIndex = "9999";
            toast.style.opacity = "0";
            toast.style.transition = "opacity 0.3s";

            document.body.appendChild(toast);

            // Fade in
            setTimeout(() => {
                toast.style.opacity = "1";
            }, 10);

            // Fade out and remove
            setTimeout(() => {
                toast.style.opacity = "0";
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        document.getElementById("nextButton").addEventListener("click", function() {
            var name = document.getElementById("nameInput").value;
            if (name) {
                document.querySelector(".first").style.display = "none";
                document.querySelector(".next").style.display = "block";
            } else {
                showToast("Please enter your name.");
            }
        });

        document.getElementById("startQuizButton").addEventListener("click", function() {
            var grade = document.getElementById("gradeSelect").value;
            if (grade) {
                document.querySelector(".next").style.display = "none";
                document.querySelector(".third").style.display = "block";
            } else {
                showToast("Please select a grade.");
            }
        });

        document.getElementById("languageButton").addEventListener("click", function() {
            var language = document.getElementById("languageSelect").value;
            if (language) {
                document.querySelector(".third").style.display = "none";
                document.querySelector(".fourth").style.display = "block";
            } else {
                showToast("Please select a language.");
            }
        });

        document.getElementById("themeButton").addEventListener("click", function() {
            var theme = document.getElementById("themeSelect").value;
            if (theme) {
                document.querySelector(".fourth").style.display = "none";
                document.querySelector(".fifth").style.display = "block";
            } else {
                showToast("Please select a theme.");
            }
        });
        // On page load, check if profile exists and show correct section
        window.addEventListener("DOMContentLoaded", function() {
            var profile = localStorage.getItem("schoolProfile");
            if (profile) {
            document.querySelector(".start-screen").style.display = "none";
            document.querySelector(".home-screen").style.display = "block";
            } else {
            // Show only the first section
            document.querySelector(".first").style.display = "block";
            document.querySelector(".next").style.display = "none";
            document.querySelector(".third").style.display = "none";
            document.querySelector(".fourth").style.display = "none";
            document.querySelector(".fifth").style.display = "none";
            document.querySelector(".start-screen").style.display = "block";
            document.querySelector(".home-screen").style.display = "none";
            }
        });

        document.getElementById("submitPasswordButton").addEventListener("click", function() {
            var name = document.getElementById("nameInput").value;
            var grade = document.getElementById("gradeSelect").value;
            var language = document.getElementById("languageSelect").value;
            var theme = document.getElementById("themeSelect").value;
            var password = document.getElementById("passwordInput").value;

            // Save profile to localStorage
            var profile = {
            name: name,
            grade: grade,
            language: language,
            theme: theme,
            password: password // Save the admin password in the profile
            };
            localStorage.setItem("schoolProfile", JSON.stringify(profile));

            // Hide start screen, show home screen
            document.querySelector(".start-screen").style.display = "none";
            document.querySelector(".home-screen").style.display = "block";
        });
        window.addEventListener("DOMContentLoaded", function() {
            var profile = localStorage.getItem("schoolProfile");
            if (profile) {
                var profileObj = JSON.parse(profile);
                document.getElementById("profileName").textContent = profileObj.name || "";
            }
        });

        document.getElementById("submitPasswordButton").addEventListener("click", function() {
            var name = document.getElementById("nameInput").value;
            document.getElementById("profileName").textContent = name;
        });




    </script>
    <script src="bannedCountrys.js"></script>
    <script>
        // --- Admin Settings Modal Logic ---
        function loadAdminSettingsForm() {
            const profile = JSON.parse(localStorage.getItem("schoolProfile") || "{}");
            document.getElementById("adminProfileName").value = profile.name || "";
            document.getElementById("adminLanguage").value = profile.language || "en";
            document.getElementById("adminGrade").value = profile.grade || "1";
            document.getElementById("adminPassword").value = profile.password || "";
            document.getElementById("aiAssistantToggle").checked = !!profile.aiAssistant;
        }

        // Show/hide AI assistant icon based on profile setting
        function updateAIAssistIcon() {
            var profile = JSON.parse(localStorage.getItem("schoolProfile") || "{}");
            var aiIcon = document.getElementById("ai-assist");
            if (profile.aiAssistant) {
                aiIcon.style.display = "block";
            } else {
                aiIcon.style.display = "none";
            }
        }

        document.getElementById("adminSettingsSave").onclick = function() {
            let profile = JSON.parse(localStorage.getItem("schoolProfile") || "{}");
            profile.name = document.getElementById("adminProfileName").value.trim();
            profile.language = document.getElementById("adminLanguage").value;
            profile.grade = document.getElementById("adminGrade").value;
            profile.password = document.getElementById("adminPassword").value;
            profile.aiAssistant = document.getElementById("aiAssistantToggle").checked;
            localStorage.setItem("schoolProfile", JSON.stringify(profile));
            // Update profile name everywhere
            document.getElementById("profileName").textContent = profile.name || "";
            // Apply theme/language changes if needed
            translateStaticUI && translateStaticUI();
            applyTheme && applyTheme(profile.theme || "light");
            showToast && showToast("Settings saved.");
            document.getElementById("adminSettingsModal").style.display = "none";
            updateAIAssistIcon();
        };

        // On page load, always update profile name on the button and AI icon
        window.addEventListener("DOMContentLoaded", function() {
            var profile = localStorage.getItem("schoolProfile");
            if (profile) {
                var profileObj = JSON.parse(profile);
                document.getElementById("profileName").textContent = profileObj.name || "";
            }
            updateAIAssistIcon();
        });

        // Show form values when modal opens
        (function() {
            const modal = document.getElementById("adminSettingsModal");
        const observer = new MutationObserver(function() {
            // Clear history logic
            document.getElementById("clearHistoryBtn").onclick = function() {
                document.getElementById("confirmClearHistoryModal").style.display = "flex";
            };
            document.getElementById("cancelClearHistory").onclick = function() {
                document.getElementById("confirmClearHistoryModal").style.display = "none";
            };
            document.getElementById("confirmClearHistory").onclick = function() {
                // Clear quiz history arrays and localStorage
                localStorage.removeItem("quizCompleted");
                localStorage.removeItem("quizHistory");
                let profile = JSON.parse(localStorage.getItem("schoolProfile") || "{}");
                profile.completedQuizzes = [];
                localStorage.setItem("schoolProfile", JSON.stringify(profile));
                // Update UI
                if (typeof renderQuizzes === "function") {
                    renderQuizzes(document.getElementById("quiz-completed"), []);
                }
                if (typeof renderHistoryList === "function") {
                    renderHistoryList("");
                }
                document.getElementById("confirmClearHistoryModal").style.display = "none";
                showToast && showToast("All history cleared.");
            };
        });
        observer.observe(modal, { attributes: true, childList: true, subtree: true });
        })();
    </script>
</body>
</html>
